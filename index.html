<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sampan Pawn Shop - Complete Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: white;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        .shop-name {
            color: #f39c12;
            font-weight: bold;
            font-size: 1.4em;
            margin-bottom: 15px;
        }
        
        .subtitle {
            color: #ecf0f1;
            font-size: 1.1em;
            margin-top: 10px;
        }
        
        .date-section {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
        }
        
        .date-box {
            background: white;
            padding: 12px 20px;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-weight: 600;
            color: #2c3e50;
        }
        
        .dashboard-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .card-title {
            font-size: 1.2rem;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .main-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            height: fit-content;
        }
        
        .section-title {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .cash-section {
            border-top: 4px solid #3498db;
        }
        
        .items-section {
            border-top: 4px solid #9b59b6;
        }
        
        .prenda-section {
            border-top: 4px solid #e74c3c;
        }
        
        .gold-section {
            border-top: 4px solid #f1c40f;
        }
        
        .sold-section {
            border-top: 4px solid #2ecc71;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #444;
            font-size: 0.9em;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.95rem;
            transition: border 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 15px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th {
            background-color: #f8f9fa;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #ddd;
        }
        
        td {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-success {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-warning {
            background-color: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #d68910;
        }
        
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .status-active {
            background: #2ecc71;
            color: white;
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 0.85em;
            display: inline-block;
        }
        
        .positive {
            color: #2ecc71;
            font-weight: bold;
        }
        
        .negative {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .transaction-row {
            display: grid;
            grid-template-columns: 2fr 1fr 40px;
            gap: 10px;
            margin-bottom: 12px;
            align-items: end;
        }
        
        .delete-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .delete-btn:hover {
            background-color: #c0392b;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .summary-label {
            font-weight: 600;
            color: #555;
        }
        
        .summary-value {
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .cash-in {
            color: #2ecc71;
        }
        
        .cash-out {
            color: #e74c3c;
        }
        
        .actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            color: #7f8c8d;
            font-size: 0.9rem;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                padding: 10px;
                background: white;
            }
            
            .section {
                box-shadow: none;
                border: 1px solid #ddd;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Pawn Shop Management System</h1>
            <div class="shop-name">Sampan Pawn Shop</div>
            <div class="subtitle">Complete Daily Operations Tracking</div>
            
            <div class="date-section">
                <div class="date-box">
                    <label for="date">Date:</label>
                    <input type="date" id="date" value="">
                </div>
                <div class="date-box">
                    <label for="prepared-by">Prepared By:</label>
                    <input type="text" id="prepared-by" placeholder="Staff Name">
                </div>
            </div>
        </header>
        
        <!-- Dashboard -->
        <div class="dashboard-container">
            <div class="dashboard-card">
                <div class="card-title">üìä Quick Stats</div>
                <div class="summary-item">
                    <span>Active Pawns:</span>
                    <strong id="active-pawns">0</strong>
                </div>
                <div class="summary-item">
                    <span>Today's Sales:</span>
                    <strong class="positive" id="today-sales">‚Ç±0.00</strong>
                </div>
                <div class="summary-item">
                    <span>Today's Purchases:</span>
                    <strong class="negative" id="today-purchases">‚Ç±0.00</strong>
                </div>
            </div>
            
            <div class="dashboard-card">
                <div class="card-title">üí∞ Cash Position</div>
                <div class="summary-item">
                    <span>Opening Balance:</span>
                    <strong>‚Ç±<input type="number" id="opening-balance" value="5000" style="width: 120px; border: none; text-align: right; font-weight: bold;"></strong>
                </div>
                <div class="summary-item">
                    <span>Cash In Today:</span>
                    <strong class="cash-in" id="dash-cash-in">‚Ç±0.00</strong>
                </div>
                <div class="summary-item">
                    <span>Cash Out Today:</span>
                    <strong class="cash-out" id="dash-cash-out">‚Ç±0.00</strong>
                </div>
                <div class="summary-item" style="border-top: 2px solid #ddd; padding-top: 10px;">
                    <span>Closing Balance:</span>
                    <strong id="dash-closing-bal">‚Ç±5,000.00</strong>
                </div>
            </div>
            
            <div class="dashboard-card">
                <div class="card-title">‚ö° Quick Actions</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <button class="btn btn-primary" onclick="showSection('cash-flow')">üí∏ Cash Flow</button>
                    <button class="btn btn-warning" onclick="showSection('prenda')">üìù New Pawn</button>
                    <button class="btn btn-success" onclick="showSection('renew')">üîÑ Process Renew</button>
                    <button class="btn btn-danger" onclick="showSection('sold')">üí∞ Record Sale</button>
                </div>
            </div>
        </div>
        
        <!-- Main Content Sections -->
        <div class="main-container">
            <!-- Left Column -->
            <div>
                <!-- Cash Flow Section -->
                <div class="section cash-section" id="cash-flow-section">
                    <div class="section-title">
                        <span>üí∏ Daily Cash Flow</span>
                    </div>
                    
                    <div class="form-group">
                        <label>Cash Inflows (Pumasok na Pera)</label>
                        <div id="cash-in-container">
                            <div class="transaction-row">
                                <div>
                                    <input type="text" class="cash-in-desc" value="Sales" placeholder="Description">
                                </div>
                                <div>
                                    <input type="number" class="cash-in-amount" placeholder="Amount" value="0">
                                </div>
                                <button class="delete-btn" onclick="deleteRow(this)">√ó</button>
                            </div>
                            <div class="transaction-row">
                                <div>
                                    <input type="text" class="cash-in-desc" value="Renew" placeholder="Description">
                                </div>
                                <div>
                                    <input type="number" class="cash-in-amount" placeholder="Amount" value="0">
                                </div>
                                <button class="delete-btn" onclick="deleteRow(this)">√ó</button>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="addCashInRow()">+ Add Cash In</button>
                    </div>
                    
                    <div class="form-group">
                        <label>Cash Outflows (Labas na Pera)</label>
                        <div id="cash-out-container">
                            <div class="transaction-row">
                                <div>
                                    <input type="text" class="cash-out-desc" value="Expenses" placeholder="Description">
                                </div>
                                <div>
                                    <input type="number" class="cash-out-amount" placeholder="Amount" value="0">
                                </div>
                                <button class="delete-btn" onclick="deleteRow(this)">√ó</button>
                            </div>
                            <div class="transaction-row">
                                <div>
                                    <input type="text" class="cash-out-desc" value="Prenda" placeholder="Description">
                                </div>
                                <div>
                                    <input type="number" class="cash-out-amount" placeholder="Amount" value="0">
                                </div>
                                <button class="delete-btn" onclick="deleteRow(this)">√ó</button>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="addCashOutRow()">+ Add Cash Out</button>
                    </div>
                    
                    <div class="summary-item">
                        <span>Total Cash In:</span>
                        <strong class="cash-in" id="total-cash-in">‚Ç±0.00</strong>
                    </div>
                    <div class="summary-item">
                        <span>Total Cash Out:</span>
                        <strong class="cash-out" id="total-cash-out">‚Ç±0.00</strong>
                    </div>
                    <div class="summary-item">
                        <span>Net Cash Flow:</span>
                        <strong id="net-cash-flow">‚Ç±0.00</strong>
                    </div>
                </div>
                
                <!-- Pawn Items Section -->
                <div class="section prenda-section" id="prenda-section">
                    <div class="section-title">
                        <span>üìù New Pawn Item (Prenda)</span>
                    </div>
                    
                    <div class="form-group">
                        <label>Item Code</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="item-code-prefix" value="P-" style="width: 80px;" readonly>
                            <input type="text" id="item-code-suffix" value="001" style="width: 80px;">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Item Name/Description</label>
                        <input type="text" id="item-name" placeholder="e.g., Gold Ring, Laptop, etc.">
                    </div>
                    
                    <div class="form-group">
                        <label>Item Type</label>
                        <select id="item-type">
                            <option value="Jewelry">Jewelry</option>
                            <option value="Electronics">Electronics</option>
                            <option value="Appliances">Appliances</option>
                            <option value="Tools">Tools</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>Weight (grams)</label>
                            <input type="number" id="item-weight" placeholder="0.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Karat (for gold)</label>
                            <input type="number" id="item-karat" placeholder="e.g., 18, 24">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Pawn Amount (‚Ç±)</label>
                        <input type="number" id="pawn-amount" placeholder="0.00" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label>Customer Name</label>
                        <input type="text" id="customer-name" placeholder="Customer Name">
                    </div>
                    
                    <div class="form-group">
                        <label>Contact Number</label>
                        <input type="text" id="customer-contact" placeholder="09XXXXXXXXX">
                    </div>
                    
                    <button class="btn btn-warning" style="width: 100%; padding: 12px;" onclick="addPawnItem()">
                        ‚úÖ Add Pawn Item
                    </button>
                </div>
                
                <!-- Gold Purchases Section -->
                <div class="section gold-section">
                    <div class="section-title">
                        <span>ü•á Gold Purchases (Scrap Gold)</span>
                    </div>
                    
                    <div class="form-group">
                        <label>Transaction Code</label>
                        <input type="text" id="gold-code" value="G-" placeholder="G-001">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>Weight (grams)</label>
                            <input type="number" id="gold-weight" placeholder="0.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Karat</label>
                            <input type="number" id="gold-karat" placeholder="18, 22, 24">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Price per Gram (‚Ç±)</label>
                        <input type="number" id="gold-price-per-gram" placeholder="0.00" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label>Total Amount (‚Ç±)</label>
                        <input type="number" id="gold-total-amount" placeholder="0.00" step="0.01" readonly>
                    </div>
                    
                    <button class="btn btn-warning" style="width: 100%; padding: 12px;" onclick="addGoldPurchase()">
                        üí∞ Add Gold Purchase
                    </button>
                </div>
            </div>
            
            <!-- Right Column -->
            <div>
                <!-- Active Pawns List -->
                <div class="section prenda-section">
                    <div class="section-title">
                        <span>üìã Active Pawn Items</span>
                        <span class="status-active" id="active-count">0 items</span>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>Item</th>
                                    <th>Amount</th>
                                    <th>Customer</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pawn-items-body">
                                <!-- Pawn items will be loaded here -->
                                <tr>
                                    <td colspan="5" style="text-align: center; padding: 20px; color: #7f8c8d;">
                                        No active pawn items yet
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Renew Section -->
                <div class="section items-section" id="renew-section">
                    <div class="section-title">
                        <span>üîÑ Process Renewal</span>
                    </div>
                    
                    <div class="form-group">
                        <label>Renew Code</label>
                        <input type="text" id="renew-code" value="R-" placeholder="R-001">
                    </div>
                    
                    <div class="form-group">
                        <label>Pawn Item Code</label>
                        <input type="text" id="renew-item-code" placeholder="Enter item code">
                    </div>
                    
                    <div class="form-group">
                        <label>Item Name</label>
                        <input type="text" id="renew-item-name" placeholder="Item description">
                    </div>
                    
                    <div class="form-group">
                        <label>Renewal Amount (‚Ç±)</label>
                        <input type="number" id="renew-amount" placeholder="0.00" step="0.01">
                    </div>
                    
                    <button class="btn btn-success" style="width: 100%; padding: 12px;" onclick="processRenewal()">
                        üîÑ Process Renewal
                    </button>
                </div>
                
                <!-- Sold Items Section -->
                <div class="section sold-section" id="sold-section">
                    <div class="section-title">
                        <span>üí∞ Record Sold Item</span>
                    </div>
                    
                    <div class="form-group">
                        <label>Sale Code</label>
                        <input type="text" id="sold-item-code" value="S-" placeholder="S-001">
                    </div>
                    
                    <div class="form-group">
                        <label>Item Name</label>
                        <input type="text" id="sold-item-name" placeholder="Item description">
                    </div>
                    
                    <div class="form-group">
                        <label>Item Type</label>
                        <select id="sold-item-type">
                            <option value="Jewelry">Jewelry</option>
                            <option value="Electronics">Electronics</option>
                            <option value="Appliances">Appliances</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>Weight (grams)</label>
                            <input type="number" id="sold-weight" placeholder="0.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Karat</label>
                            <input type="number" id="sold-karat" placeholder="e.g., 18, 24">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Sale Price (‚Ç±)</label>
                        <input type="number" id="sale-price" placeholder="0.00" step="0.01">
                    </div>
                    
                    <button class="btn btn-danger" style="width: 100%; padding: 12px;" onclick="addNewSoldItem()">
                        üí∞ Record Sale
                    </button>
                </div>
                
                <!-- Silver Purchases Section -->
                <div class="section gold-section">
                    <div class="section-title">
                        <span>ü•à Silver Purchases (Scrap Silver)</span>
                    </div>
                    
                    <div class="form-group">
                        <label>Transaction Code</label>
                        <input type="text" id="silver-code" value="AG-" placeholder="AG-001">
                    </div>
                    
                    <div class="form-group">
                        <label>Weight (grams)</label>
                        <input type="number" id="silver-weight" placeholder="0.00" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label>Price per Gram (‚Ç±)</label>
                        <input type="number" id="silver-price-per-gram" placeholder="0.00" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label>Total Amount (‚Ç±)</label>
                        <input type="number" id="silver-total-amount" placeholder="0.00" step="0.01" readonly>
                    </div>
                    
                    <button class="btn btn-warning" style="width: 100%; padding: 12px;" onclick="addSilverPurchase()">
                        üí∞ Add Silver Purchase
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Reports Section -->
        <div class="dashboard-card" style="margin-top: 30px;">
            <div class="card-title">üìä Daily Report</div>
            <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="generateDailyReport()">
                    üìã Generate Daily Report
                </button>
                <button class="btn btn-success" onclick="printReport()">
                    üñ®Ô∏è Print Report
                </button>
                <button class="btn btn-danger" onclick="clearTodayData()">
                    üóëÔ∏è Clear Today's Data
                </button>
            </div>
            <div id="report-results" style="min-height: 100px; padding: 20px; background: #f8f9fa; border-radius: 5px;">
                <div style="text-align: center; color: #7f8c8d;">
                    Click "Generate Daily Report" to view today's summary
                </div>
            </div>
        </div>
        
        <footer>
            <p>Sampan Pawn Shop Management System &copy; <span id="current-year"></span></p>
            <p style="margin-top: 10px; font-size: 0.9em; color: #95a5a6;">
                All data is stored locally in your browser. Export data regularly for backup.
            </p>
        </footer>
    </div>
    
    <!-- JavaScript -->
    <script>
        // ==================== DATA STORAGE ====================
        let pawnItems = JSON.parse(localStorage.getItem('pawnItems')) || [];
        let renewTransactions = JSON.parse(localStorage.getItem('renewTransactions')) || [];
        let soldItems = JSON.parse(localStorage.getItem('soldItems')) || [];
        let goldPurchases = JSON.parse(localStorage.getItem('goldPurchases')) || [];
        let silverPurchases = JSON.parse(localStorage.getItem('silverPurchases')) || [];
        let cashInTransactions = JSON.parse(localStorage.getItem('cashInTransactions')) || [];
        let cashOutTransactions = JSON.parse(localStorage.getItem('cashOutTransactions')) || [];

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            
            // Set current year
            document.getElementById('current-year').textContent = new Date().getFullYear();
            
            // Load all data
            loadPawnItems();
            loadDashboard();
            calculateTotals();
            
            // Setup event listeners
            setupEventListeners();
            
            // Auto-calculate totals
            setInterval(calculateTotals, 1000);
        });

        // ==================== PAWN ITEMS MANAGEMENT ====================
        function addPawnItem() {
            const itemCode = document.getElementById('item-code-prefix').value + 
                            document.getElementById('item-code-suffix').value;
            const itemName = document.getElementById('item-name').value;
            const itemType = document.getElementById('item-type').value;
            const weight = document.getElementById('item-weight').value;
            const karat = document.getElementById('item-karat').value;
            const pawnAmount = document.getElementById('pawn-amount').value;
            const customerName = document.getElementById('customer-name').value;
            const contact = document.getElementById('customer-contact').value;
            
            if (!itemName || !pawnAmount) {
                alert('Please fill in Item Name and Pawn Amount');
                return;
            }
            
            const newItem = {
                id: Date.now(),
                itemCode: itemCode,
                itemName: itemName,
                itemType: itemType,
                weight: weight,
                karat: karat,
                pawnAmount: parseFloat(pawnAmount),
                customerName: customerName,
                contact: contact,
                pawnDate: new Date().toISOString().split('T')[0],
                status: 'Active'
            };
            
            pawnItems.push(newItem);
            localStorage.setItem('pawnItems', JSON.stringify(pawnItems));
            loadPawnItems();
            loadDashboard();
            
            // Add to cash out
            addToCashOut('Prenda - ' + itemCode, pawnAmount);
            
            // Clear form
            document.getElementById('item-name').value = '';
            document.getElementById('item-weight').value = '';
            document.getElementById('item-karat').value = '';
            document.getElementById('pawn-amount').value = '';
            document.getElementById('customer-name').value = '';
            document.getElementById('customer-contact').value = '';
            
            // Increment item code
            const currentSuffix = parseInt(document.getElementById('item-code-suffix').value) || 1;
            document.getElementById('item-code-suffix').value = (currentSuffix + 1).toString().padStart(3, '0');
            
            alert('Pawn item added successfully!');
        }

        function loadPawnItems() {
            const tbody = document.getElementById('pawn-items-body');
            const activeItems = pawnItems.filter(item => item.status === 'Active');
            
            tbody.innerHTML = '';
            
            if (activeItems.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 20px; color: #7f8c8d;">
                            No active pawn items yet
                        </td>
                    </tr>
                `;
                return;
            }
            
            activeItems.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.itemCode}</td>
                    <td>${item.itemName}</td>
                    <td>‚Ç±${item.pawnAmount.toFixed(2)}</td>
                    <td>${item.customerName}</td>
                    <td>
                        <button class="btn btn-success" style="padding: 5px 10px; font-size: 0.8em;" onclick="renewItem('${item.id}')">
                            Renew
                        </button>
                        <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.8em;" onclick="sellPawnItem('${item.id}')">
                            Sell
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function renewItem(itemId) {
            const item = pawnItems.find(p => p.id == itemId);
            if (!item) return;
            
            const renewAmount = prompt(`Enter renewal amount for ${item.itemCode} (${item.itemName}):`, 
                                     (item.pawnAmount * 0.05).toFixed(2));
            
            if (renewAmount && !isNaN(renewAmount)) {
                const renewCode = 'R-' + Date.now().toString().slice(-6);
                const newRenew = {
                    id: Date.now(),
                    renewCode: renewCode,
                    itemCode: item.itemCode,
                    itemName: item.itemName,
                    renewAmount: parseFloat(renewAmount),
                    renewDate: new Date().toISOString().split('T')[0]
                };
                
                renewTransactions.push(newRenew);
                localStorage.setItem('renewTransactions', JSON.stringify(renewTransactions));
                
                // Add to cash in
                addToCashIn('Renew - ' + item.itemCode, renewAmount);
                
                alert(`Renewal processed: ${renewCode} - ‚Ç±${parseFloat(renewAmount).toFixed(2)}`);
                loadDashboard();
            }
        }

        function sellPawnItem(itemId) {
            const item = pawnItems.find(p => p.id == itemId);
            if (!item) return;
            
            const salePrice = prompt(`Enter sale price for ${item.itemCode} (${item.itemName}):`, 
                                   (item.pawnAmount * 1.3).toFixed(2));
            
            if (salePrice && !isNaN(salePrice)) {
                // Mark as sold
                item.status = 'Sold';
                localStorage.setItem('pawnItems', JSON.stringify(pawnItems));
                
                // Add to sold items
                const soldCode = 'S-' + Date.now().toString().slice(-6);
                const newSale = {
                    id: Date.now(),
                    soldCode: soldCode,
                    itemCode: item.itemCode,
                    itemName: item.itemName,
                    itemType: item.itemType,
                    salePrice: parseFloat(salePrice),
                    profit: parseFloat(salePrice) - item.pawnAmount,
                    saleDate: new Date().toISOString().split('T')[0]
                };
                
                soldItems.push(newSale);
                localStorage.setItem('soldItems', JSON.stringify(soldItems));
                
                // Add to cash in
                addToCashIn('Sold - ' + item.itemCode, salePrice);
                
                alert(`Item sold: ${soldCode} - Sale: ‚Ç±${parseFloat(salePrice).toFixed(2)}`);
                loadPawnItems();
                loadDashboard();
            }
        }

        // ==================== CASH FLOW MANAGEMENT ====================
        function addToCashIn(description, amount) {
            const container = document.getElementById('cash-in-container');
            const row = document.createElement('div');
            row.className = 'transaction-row';
            row.innerHTML = `
                <div>
                    <input type="text" class="cash-in-desc" value="${description}" readonly>
                </div>
                <div>
                    <input type="number" class="cash-in-amount" value="${amount}" min="0" step="0.01">
                </div>
                <button class="delete-btn" onclick="deleteRow(this)">√ó</button>
            `;
            container.appendChild(row);
            
            // Save to localStorage
            cashInTransactions.push({ description, amount: parseFloat(amount) });
            localStorage.setItem('cashInTransactions', JSON.stringify(cashInTransactions));
            
            calculateTotals();
        }

        function addToCashOut(description, amount) {
            const container = document.getElementById('cash-out-container');
            const row = document.createElement('div');
            row.className = 'transaction-row';
            row.innerHTML = `
                <div>
                    <input type="text" class="cash-out-desc" value="${description}" readonly>
                </div>
                <div>
                    <input type="number" class="cash-out-amount" value="${amount}" min="0" step="0.01">
                </div>
                <button class="delete-btn" onclick="deleteRow(this)">√ó</button>
            `;
            container.appendChild(row);
            
            // Save to localStorage
            cashOutTransactions.push({ description, amount: parseFloat(amount) });
            localStorage.setItem('cashOutTransactions', JSON.stringify(cashOutTransactions));
            
            calculateTotals();
        }

        function addCashInRow() {
            const container = document.getElementById('cash-in-container');
            const row = document.createElement('div');
            row.className = 'transaction-row';
            row.innerHTML = `
                <div>
                    <input type="text" class="cash-in-desc" placeholder="Description">
                </div>
                <div>
                    <input type="number" class="cash-in-amount" placeholder="Amount" value="0">
                </div>
                <button class="delete-btn" onclick="deleteRow(this)">√ó</button>
            `;
            container.appendChild(row);
        }

        function addCashOutRow() {
            const container = document.getElementById('cash-out-container');
            const row = document.createElement('div');
            row.className = 'transaction-row';
            row.innerHTML = `
                <div>
                    <input type="text" class="cash-out-desc" placeholder="Description">
                </div>
                <div>
                    <input type="number" class="cash-out-amount" placeholder="Amount" value="0">
                </div>
                <button class="delete-btn" onclick="deleteRow(this)">√ó</button>
            `;
            container.appendChild(row);
        }

        function deleteRow(button) {
            if (confirm('Delete this transaction?')) {
                button.closest('.transaction-row').remove();
                calculateTotals();
            }
        }

        function calculateTotals() {
            // Calculate cash in
            let totalCashIn = 0;
            document.querySelectorAll('.cash-in-amount').forEach(input => {
                totalCashIn += parseFloat(input.value) || 0;
            });
            
            // Calculate cash out
            let totalCashOut = 0;
            document.querySelectorAll('.cash-out-amount').forEach(input => {
                totalCashOut += parseFloat(input.value) || 0;
            });
            
            // Get opening balance
            const openingBalance = parseFloat(document.getElementById('opening-balance').value) || 0;
            
            // Calculate net cash flow and closing balance
            const netCashFlow = totalCashIn - totalCashOut;
            const closingBalance = openingBalance + netCashFlow;
            
            // Update display
            document.getElementById('total-cash-in').textContent = '‚Ç±' + totalCashIn.toFixed(2);
            document.getElementById('total-cash-out').textContent = '‚Ç±' + totalCashOut.toFixed(2);
            document.getElementById('net-cash-flow').textContent = '‚Ç±' + netCashFlow.toFixed(2);
            
            // Update dashboard
            document.getElementById('dash-cash-in').textContent = '‚Ç±' + totalCashIn.toFixed(2);
            document.getElementById('dash-cash-out').textContent = '‚Ç±' + totalCashOut.toFixed(2);
            document.getElementById('dash-closing-bal').textContent = '‚Ç±' + closingBalance.toFixed(2);
            
            // Update net cash flow color
            const netElement = document.getElementById('net-cash-flow');
            if (netCashFlow >= 0) {
                netElement.className = 'positive';
            } else {
                netElement.className = 'negative';
            }
        }

        // ==================== RENEW MANAGEMENT ====================
        function processRenewal() {
            const renewCode = document.getElementById('renew-code').value;
            const itemCode = document.getElementById('renew-item-code').value;
            const itemName = document.getElementById('renew-item-name').value;
            const renewAmount = document.getElementById('renew-amount').value;
            
            if (!renewCode || !itemCode || !renewAmount) {
                alert('Please fill in all fields');
                return;
            }
            
            const newRenew = {
                id: Date.now(),
                renewCode: renewCode,
                itemCode: itemCode,
                itemName: itemName,
                renewAmount: parseFloat(renewAmount),
                renewDate: new Date().toISOString().split('T')[0]
            };
            
            renewTransactions.push(newRenew);
            localStorage.setItem('renewTransactions', JSON.stringify(renewTransactions));
            
            // Add to cash in
            addToCashIn('Renew - ' + itemCode, renewAmount);
            
            // Clear form
            document.getElementById('renew-code').value = 'R-';
            document.getElementById('renew-item-code').value = '';
            document.getElementById('renew-item-name').value = '';
            document.getElementById('renew-amount').value = '';
            
            alert('Renewal processed successfully!');
            loadDashboard();
        }

        // ==================== SOLD ITEMS MANAGEMENT ====================
        function addNewSoldItem() {
            const soldCode = document.getElementById('sold-item-code').value;
            const itemName = document.getElementById('sold-item-name').value;
            const itemType = document.getElementById('sold-item-type').value;
            const weight = document.getElementById('sold-weight').value;
            const karat = document.getElementById('sold-karat').value;
            const salePrice = document.getElementById('sale-price').value;
            
            if (!itemName || !salePrice) {
                alert('Please fill in Item Name and Sale Price');
                return;
            }
            
            const newSale = {
                id: Date.now(),
                soldCode: soldCode,
                itemCode: 'DIRECT-' + Date.now().toString().slice(-6),
                itemName: itemName,
                itemType: itemType,
                weight: weight,
                karat: karat,
                salePrice: parseFloat(salePrice),
                profit: parseFloat(salePrice),
                saleDate: new Date().toISOString().split('T')[0]
            };
            
            soldItems.push(newSale);
            localStorage.setItem('soldItems', JSON.stringify(soldItems));
            
            // Add to cash in
            addToCashIn('Sold - ' + itemName, salePrice);
            
            // Clear form
            document.getElementById('sold-item-code').value = 'S-';
            document.getElementById('sold-item-name').value = '';
            document.getElementById('sold-weight').value = '';
            document.getElementById('sold-karat').value = '';
            document.getElementById('sale-price').value = '';
            
            alert('Sale recorded successfully!');
            loadDashboard();
        }

        // ==================== GOLD PURCHASES ====================
        function addGoldPurchase() {
            const goldCode = document.getElementById('gold-code').value;
            const weight = document.getElementById('gold-weight').value;
            const karat = document.getElementById('gold-karat').value;
            const pricePerGram = document.getElementById('gold-price-per-gram').value;
            
            if (!weight || !pricePerGram) {
                alert('Please fill in Weight and Price per Gram');
                return;
            }
            
            const totalAmount = parseFloat(weight) * parseFloat(pricePerGram);
            
            const newPurchase = {
                id: Date.now(),
                goldCode: goldCode,
                weight: parseFloat(weight),
                karat: karat,
                pricePerGram: parseFloat(pricePerGram),
                totalAmount: totalAmount,
                purchaseDate: new Date().toISOString().split('T')[0]
            };
            
            goldPurchases.push(newPurchase);
            localStorage.setItem('goldPurchases', JSON.stringify(goldPurchases));
            
            // Add to cash out
            addToCashOut('Gold Purchase - ' + goldCode, totalAmount);
            
            // Clear form
            document.getElementById('gold-weight').value = '';
            document.getElementById('gold-karat').value = '';
            document.getElementById('gold-price-per-gram').value = '';
            
            alert('Gold purchase recorded! Total: ‚Ç±' + totalAmount.toFixed(2));
            loadDashboard();
        }

        // ==================== SILVER PURCHASES ====================
        function addSilverPurchase() {
            const silverCode = document.getElementById('silver-code').value;
            const weight = document.getElementById('silver-weight').value;
            const pricePerGram = document.getElementById('silver-price-per-gram').value;
            
            if (!weight || !pricePerGram) {
                alert('Please fill in Weight and Price per Gram');
                return;
            }
            
            const totalAmount = parseFloat(weight) * parseFloat(pricePerGram);
            
            const newPurchase = {
                id: Date.now(),
                silverCode: silverCode,
                weight: parseFloat(weight),
                pricePerGram: parseFloat(pricePerGram),
                totalAmount: totalAmount,
                purchaseDate: new Date().toISOString().split('T')[0]
            };
            
            silverPurchases.push(newPurchase);
            localStorage.setItem('silverPurchases', JSON.stringify(silverPurchases));
            
            // Add to cash out
            addToCashOut('Silver Purchase - ' + silverCode, totalAmount);
            
            // Clear form
            document.getElementById('silver-weight').value = '';
            document.getElementById('silver-price-per-gram').value = '';
            
            alert('Silver purchase recorded! Total: ‚Ç±' + totalAmount.toFixed(2));
            loadDashboard();
        }

        // ==================== DASHBOARD FUNCTIONS ====================
        function loadDashboard() {
            const activePawns = pawnItems.filter(item => item.status === 'Active').length;
            const todaySales = soldItems.reduce((sum, item) => sum + item.salePrice, 0);
            const todayPurchases = goldPurchases.reduce((sum, item) => sum + item.totalAmount, 0) +
                                 silverPurchases.reduce((sum, item) => sum + item.totalAmount, 0);
            
            document.getElementById('active-pawns').textContent = activePawns;
            document.getElementById('today-sales').textContent = '‚Ç±' + todaySales.toFixed(2);
            document.getElementById('today-purchases').textContent = '‚Ç±' + todayPurchases.toFixed(2);
            document.getElementById('active-count').textContent = activePawns + ' items';
        }

        function showSection(sectionName) {
            // Scroll to section
            const sections = {
                'cash-flow': 'cash-flow-section',
                'prenda': 'prenda-section',
                'renew': 'renew-section',
                'sold': 'sold-section'
            };
            
            const sectionId = sections[sectionName];
            if (sectionId) {
                document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
            }
        }

        // ==================== REPORT FUNCTIONS ====================
        function generateDailyReport() {
            const activePawns = pawnItems.filter(item => item.status === 'Active');
            const today = new Date().toISOString().split('T')[0];
            
            let totalSales = soldItems.reduce((sum, item) => sum + item.salePrice, 0);
            let totalRenewals = renewTransactions.reduce((sum, item) => sum + item.renewAmount, 0);
            let totalPurchases = goldPurchases.reduce((sum, item) => sum + item.totalAmount, 0) +
                               silverPurchases.reduce((sum, item) => sum + item.totalAmount, 0);
            
            let totalCashIn = 0;
            document.querySelectorAll('.cash-in-amount').forEach(input => {
                totalCashIn += parseFloat(input.value) || 0;
            });
            
            let totalCashOut = 0;
            document.querySelectorAll('.cash-out-amount').forEach(input => {
                totalCashOut += parseFloat(input.value) || 0;
            });
            
            const openingBalance = parseFloat(document.getElementById('opening-balance').value) || 0;
            const closingBalance = openingBalance + totalCashIn - totalCashOut;
            
            const reportHTML = `
                <h3 style="color: #2c3e50; margin-bottom: 20px;">üìä Daily Report - ${today}</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                        <h4 style="margin-bottom: 10px;">üí∞ Cash Summary</h4>
                        <p>Opening Balance: <strong>‚Ç±${openingBalance.toFixed(2)}</strong></p>
                        <p>Total Cash In: <strong class="positive">‚Ç±${totalCashIn.toFixed(2)}</strong></p>
                        <p>Total Cash Out: <strong class="negative">‚Ç±${totalCashOut.toFixed(2)}</strong></p>
                        <p>Closing Balance: <strong>‚Ç±${closingBalance.toFixed(2)}</strong></p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                        <h4 style="margin-bottom: 10px;">üìà Transactions Summary</h4>
                        <p>Active Pawns: <strong>${activePawns.length}</strong></p>
                        <p>Total Sales: <strong class="positive">‚Ç±${totalSales.toFixed(2)}</strong></p>
                        <p>Total Renewals: <strong class="positive">‚Ç±${totalRenewals.toFixed(2)}</strong></p>
                        <p>Total Purchases: <strong class="negative">‚Ç±${totalPurchases.toFixed(2)}</strong></p>
                    </div>
                </div>
                
                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                    <h4 style="margin-bottom: 10px;">üìã Recent Transactions</h4>
                    <p>‚Ä¢ New Pawns Today: ${pawnItems.filter(item => item.pawnDate === today).length}</p>
                    <p>‚Ä¢ Renewals Today: ${renewTransactions.filter(item => item.renewDate === today).length}</p>
                    <p>‚Ä¢ Sales Today: ${soldItems.filter(item => item.saleDate === today).length}</p>
                    <p>‚Ä¢ Gold Purchases: ${goldPurchases.filter(item => item.purchaseDate === today).length}</p>
                    <p>‚Ä¢ Silver Purchases: ${silverPurchases.filter(item => item.purchaseDate === today).length}</p>
                </div>
            `;
            
            document.getElementById('report-results').innerHTML = reportHTML;
        }

        function printReport() {
            window.print();
        }

        function clearTodayData() {
            if (confirm('Are you sure you want to clear all cash transactions for today? This will reset cash flow entries but keep item records.')) {
                // Clear cash transactions
                document.getElementById('cash-in-container').innerHTML = '';
                document.getElementById('cash-out-container').innerHTML = '';
                
                // Reset cash arrays
                cashInTransactions = [];
                cashOutTransactions = [];
                localStorage.setItem('cashInTransactions', JSON.stringify(cashInTransactions));
                localStorage.setItem('cashOutTransactions', JSON.stringify(cashOutTransactions));
                
                // Add default rows back
                addCashInRow();
                addCashInRow();
                addCashOutRow();
                addCashOutRow();
                
                calculateTotals();
                alert('Today\'s cash data cleared!');
            }
        }

        // ==================== UTILITY FUNCTIONS ====================
        function setupEventListeners() {
            // Auto-calculate gold total
            document.getElementById('gold-weight').addEventListener('input', calculateGoldTotal);
            document.getElementById('gold-price-per-gram').addEventListener('input', calculateGoldTotal);
            
            // Auto-calculate silver total
            document.getElementById('silver-weight').addEventListener('input', calculateSilverTotal);
            document.getElementById('silver-price-per-gram').addEventListener('input', calculateSilverTotal);
            
            // Auto-update totals when opening balance changes
            document.getElementById('opening-balance').addEventListener('input', calculateTotals);
            
            // Auto-save cash transactions
            document.getElementById('cash-in-container').addEventListener('input', saveCashTransactions);
            document.getElementById('cash-out-container').addEventListener('input', saveCashTransactions);
        }

        function calculateGoldTotal() {
            const weight = parseFloat(document.getElementById('gold-weight').value) || 0;
            const price = parseFloat(document.getElementById('gold-price-per-gram').value) || 0;
            const total = weight * price;
            document.getElementById('gold-total-amount').value = total.toFixed(2);
        }

        function calculateSilverTotal() {
            const weight = parseFloat(document.getElementById('silver-weight').value) || 0;
            const price = parseFloat(document.getElementById('silver-price-per-gram').value) || 0;
            const total = weight * price;
            document.getElementById('silver-total-amount').value = total.toFixed(2);
        }

        function saveCashTransactions() {
            // Save cash in transactions
            const cashInRows = document.querySelectorAll('#cash-in-container .transaction-row');
            cashInTransactions = [];
            cashInRows.forEach(row => {
                const desc = row.querySelector('.cash-in-desc').value;
                const amount = parseFloat(row.querySelector('.cash-in-amount').value) || 0;
                if (desc && amount > 0) {
                    cashInTransactions.push({ description: desc, amount: amount });
                }
            });
            localStorage.setItem('cashInTransactions', JSON.stringify(cashInTransactions));
            
            // Save cash out transactions
            const cashOutRows = document.querySelectorAll('#cash-out-container .transaction-row');
            cashOutTransactions = [];
            cashOutRows.forEach(row => {
                const desc = row.querySelector('.cash-out-desc').value;
                const amount = parseFloat(row.querySelector('.cash-out-amount').value) || 0;
                if (desc && amount > 0) {
                    cashOutTransactions.push({ description: desc, amount: amount });
                }
            });
            localStorage.setItem('cashOutTransactions', JSON.stringify(cashOutTransactions));
        }
    </script>
     <script>
     // ==================== DATA STORAGE ====================
     let pawnItems = JSON.parse(localStorage.getItem('pawnItems')) || [];
     let renewTransactions = JSON.parse(localStorage.getItem('renewTransactions')) || [];
     let soldItems = JSON.parse(localStorage.getItem('soldItems')) || [];
     let goldPurchases = JSON.parse(localStorage.getItem('goldPurchases')) || [];
     let silverPurchases = JSON.parse(localStorage.getItem('silverPurchases')) || [];
     let cashInTransactions = JSON.parse(localStorage.getItem('cashInTransactions')) || [];
     let cashOutTransactions = JSON.parse(localStorage.getItem('cashOutTransactions')) || [];

     // ==================== INITIALIZATION ====================
     document.addEventListener('DOMContentLoaded', function() {
         // Set today's date
         const today = new Date().toISOString().split('T')[0];
         document.getElementById('date').value = today;
         
         // Set current year
         document.getElementById('current-year').textContent = new Date().getFullYear();
         
         // Load all data
         loadPawnItems();
         loadDashboard();
         calculateTotals();
         
         // Setup event listeners
         setupEventListeners();
         
         // Auto-calculate totals
         setInterval(calculateTotals, 1000);
     });

     // ==================== PAWN ITEMS MANAGEMENT ====================
     function addPawnItem() {
         const itemCode = document.getElementById('item-code-prefix').value + 
                         document.getElementById('item-code-suffix').value;
         const itemName = document.getElementById('item-name').value;
         const itemType = document.getElementById('item-type').value;
         const weight = document.getElementById('item-weight').value;
         const karat = document.getElementById('item-karat').value;
         const pawnAmount = document.getElementById('pawn-amount').value;
         const customerName = document.getElementById('customer-name').value;
         const contact = document.getElementById('customer-contact').value;
         
         if (!itemName || !pawnAmount) {
             alert('Please fill in Item Name and Pawn Amount');
             return;
         }
         
         const newItem = {
             id: Date.now(),
             itemCode: itemCode,
             itemName: itemName,
             itemType: itemType,
             weight: weight,
             karat: karat,
             pawnAmount: parseFloat(pawnAmount),
             customerName: customerName,
             contact: contact,
             pawnDate: new Date().toISOString().split('T')[0],
             status: 'Active'
         };
         
         pawnItems.push(newItem);
         localStorage.setItem('pawnItems', JSON.stringify(pawnItems));
         loadPawnItems();
         loadDashboard();
         
         // Add to cash out
         addToCashOut('Prenda - ' + itemCode, pawnAmount);
         
         // Clear form
         document.getElementById('item-name').value = '';
         document.getElementById('item-weight').value = '';
         document.getElementById('item-karat').value = '';
         document.getElementById('pawn-amount').value = '';
         document.getElementById('customer-name').value = '';
         document.getElementById('customer-contact').value = '';
         
         // Increment item code
         const currentSuffix = parseInt(document.getElementById('item-code-suffix').value) || 1;
         document.getElementById('item-code-suffix').value = (currentSuffix + 1).toString().padStart(3, '0');
         
         alert('Pawn item added successfully!');
     }

     function loadPawnItems() {
         const tbody = document.getElementById('pawn-items-body');
         const activeItems = pawnItems.filter(item => item.status === 'Active');
         
         tbody.innerHTML = '';
         
         if (activeItems.length === 0) {
             tbody.innerHTML = `
                 <tr>
                     <td colspan="5" style="text-align: center; padding: 20px; color: #7f8c8d;">
                         No active pawn items yet
                     </td>
                 </tr>
             `;
             return;
         }
         
         activeItems.forEach(item => {
             const row = document.createElement('tr');
             row.innerHTML = `
                 <td>${item.itemCode}</td>
                 <td>${item.itemName}</td>
                 <td>‚Ç±${item.pawnAmount.toFixed(2)}</td>
                 <td>${item.customerName}</td>
                 <td>
                     <button class="btn btn-success" style="padding: 5px 10px; font-size: 0.8em;" onclick="renewItem('${item.id}')">
                         Renew
                     </button>
                     <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.8em;" onclick="sellPawnItem('${item.id}')">
                         Sell
                     </button>
                 </td>
             `;
             tbody.appendChild(row);
         });
     }

     function renewItem(itemId) {
         const item = pawnItems.find(p => p.id == itemId);
         if (!item) return;
         
         const renewAmount = prompt(`Enter renewal amount for ${item.itemCode} (${item.itemName}):`, 
                                  (item.pawnAmount * 0.05).toFixed(2));
         
         if (renewAmount && !isNaN(renewAmount)) {
             const renewCode = 'R-' + Date.now().toString().slice(-6);
             const newRenew = {
                 id: Date.now(),
                 renewCode: renewCode,
                 itemCode: item.itemCode,
                 itemName: item.itemName,
                 renewAmount: parseFloat(renewAmount),
                 renewDate: new Date().toISOString().split('T')[0]
             };
             
             renewTransactions.push(newRenew);
             localStorage.setItem('renewTransactions', JSON.stringify(renewTransactions));
             
             // Add to cash in
             addToCashIn('Renew - ' + item.itemCode, renewAmount);
             
             alert(`Renewal processed: ${renewCode} - ‚Ç±${parseFloat(renewAmount).toFixed(2)}`);
             loadDashboard();
         }
     }

     function sellPawnItem(itemId) {
         const item = pawnItems.find(p => p.id == itemId);
         if (!item) return;
         
         const salePrice = prompt(`Enter sale price for ${item.itemCode} (${item.itemName}):`, 
                                (item.pawnAmount * 1.3).toFixed(2));
         
         if (salePrice && !isNaN(salePrice)) {
             // Mark as sold
             item.status = 'Sold';
             localStorage.setItem('pawnItems', JSON.stringify(pawnItems));
             
             // Add to sold items
             const soldCode = 'S-' + Date.now().toString().slice(-6);
             const newSale = {
                 id: Date.now(),
                 soldCode: soldCode,
                 itemCode: item.itemCode,
                 itemName: item.itemName,
                 itemType: item.itemType,
                 salePrice: parseFloat(salePrice),
                 profit: parseFloat(salePrice) - item.pawnAmount,
                 saleDate: new Date().toISOString().split('T')[0]
             };
             
             soldItems.push(newSale);
             localStorage.setItem('soldItems', JSON.stringify(soldItems));
             
             // Add to cash in
             addToCashIn('Sold - ' + item.itemCode, salePrice);
             
             alert(`Item sold: ${soldCode} - Sale: ‚Ç±${parseFloat(salePrice).toFixed(2)}`);
             loadPawnItems();
             loadDashboard();
         }
     }

     // ==================== CASH FLOW MANAGEMENT ====================
     function addToCashIn(description, amount) {
         const container = document.getElementById('cash-in-container');
         const row = document.createElement('div');
         row.className = 'transaction-row';
         row.innerHTML = `
             <div>
                 <input type="text" class="cash-in-desc" value="${description}" readonly>
             </div>
             <div>
                 <input type="number" class="cash-in-amount" value="${amount}" min="0" step="0.01">
             </div>
             <button class="delete-btn" onclick="deleteRow(this)">√ó</button>
         `;
         container.appendChild(row);
         
         // Save to localStorage
         cashInTransactions.push({ description, amount: parseFloat(amount) });
         localStorage.setItem('cashInTransactions', JSON.stringify(cashInTransactions));
         
         calculateTotals();
     }

     function addToCashOut(description, amount) {
         const container = document.getElementById('cash-out-container');
         const row = document.createElement('div');
         row.className = 'transaction-row';
         row.innerHTML = `
             <div>
                 <input type="text" class="cash-out-desc" value="${description}" readonly>
             </div>
             <div>
                 <input type="number" class="cash-out-amount" value="${amount}" min="0" step="0.01">
             </div>
             <button class="delete-btn" onclick="deleteRow(this)">√ó</button>
         `;
         container.appendChild(row);
         
         // Save to localStorage
         cashOutTransactions.push({ description, amount: parseFloat(amount) });
         localStorage.setItem('cashOutTransactions', JSON.stringify(cashOutTransactions));
         
         calculateTotals();
     }

     function addCashInRow() {
         const container = document.getElementById('cash-in-container');
         const row = document.createElement('div');
         row.className = 'transaction-row';
         row.innerHTML = `
             <div>
                 <input type="text" class="cash-in-desc" placeholder="Description">
             </div>
             <div>
                 <input type="number" class="cash-in-amount" placeholder="Amount" value="0">
             </div>
             <button class="delete-btn" onclick="deleteRow(this)">√ó</button>
         `;
         container.appendChild(row);
     }

     function addCashOutRow() {
         const container = document.getElementById('cash-out-container');
         const row = document.createElement('div');
         row.className = 'transaction-row';
         row.innerHTML = `
             <div>
                 <input type="text" class="cash-out-desc" placeholder="Description">
             </div>
             <div>
                 <input type="number" class="cash-out-amount" placeholder="Amount" value="0">
             </div>
             <button class="delete-btn" onclick="deleteRow(this)">√ó</button>
         `;
         container.appendChild(row);
     }

     function deleteRow(button) {
         if (confirm('Delete this transaction?')) {
             button.closest('.transaction-row').remove();
             calculateTotals();
         }
     }

     function calculateTotals() {
         // Calculate cash in
         let totalCashIn = 0;
         document.querySelectorAll('.cash-in-amount').forEach(input => {
             totalCashIn += parseFloat(input.value) || 0;
         });
         
         // Calculate cash out
         let totalCashOut = 0;
         document.querySelectorAll('.cash-out-amount').forEach(input => {
             totalCashOut += parseFloat(input.value) || 0;
         });
         
         // Get opening balance
         const openingBalance = parseFloat(document.getElementById('opening-balance').value) || 0;
         
         // Calculate net cash flow and closing balance
         const netCashFlow = totalCashIn - totalCashOut;
         const closingBalance = openingBalance + netCashFlow;
         
         // Update display
         document.getElementById('total-cash-in').textContent = '‚Ç±' + totalCashIn.toFixed(2);
         document.getElementById('total-cash-out').textContent = '‚Ç±' + totalCashOut.toFixed(2);
         document.getElementById('net-cash-flow').textContent = '‚Ç±' + netCashFlow.toFixed(2);
         
         // Update dashboard
         document.getElementById('dash-cash-in').textContent = '‚Ç±' + totalCashIn.toFixed(2);
         document.getElementById('dash-cash-out').textContent = '‚Ç±' + totalCashOut.toFixed(2);
         document.getElementById('dash-closing-bal').textContent = '‚Ç±' + closingBalance.toFixed(2);
         
         // Update net cash flow color
         const netElement = document.getElementById('net-cash-flow');
         if (netCashFlow >= 0) {
             netElement.className = 'positive';
         } else {
             netElement.className = 'negative';
         }
     }

     // ==================== RENEW MANAGEMENT ====================
     function processRenewal() {
         const renewCode = document.getElementById('renew-code').value;
         const itemCode = document.getElementById('renew-item-code').value;
         const itemName = document.getElementById('renew-item-name').value;
         const renewAmount = document.getElementById('renew-amount').value;
         
         if (!renewCode || !itemCode || !renewAmount) {
             alert('Please fill in all fields');
             return;
         }
         
         const newRenew = {
             id: Date.now(),
             renewCode: renewCode,
             itemCode: itemCode,
             itemName: itemName,
             renewAmount: parseFloat(renewAmount),
             renewDate: new Date().toISOString().split('T')[0]
         };
         
         renewTransactions.push(newRenew);
         localStorage.setItem('renewTransactions', JSON.stringify(renewTransactions));
         
         // Add to cash in
         addToCashIn('Renew - ' + itemCode, renewAmount);
         
         // Clear form
         document.getElementById('renew-code').value = 'R-';
         document.getElementById('renew-item-code').value = '';
         document.getElementById('renew-item-name').value = '';
         document.getElementById('renew-amount').value = '';
         
         alert('Renewal processed successfully!');
         loadDashboard();
     }

     // ==================== SOLD ITEMS MANAGEMENT ====================
     function addNewSoldItem() {
         const soldCode = document.getElementById('sold-item-code').value;
         const itemName = document.getElementById('sold-item-name').value;
         const itemType = document.getElementById('sold-item-type').value;
         const weight = document.getElementById('sold-weight').value;
         const karat = document.getElementById('sold-karat').value;
         const salePrice = document.getElementById('sale-price').value;
         
         if (!itemName || !salePrice) {
             alert('Please fill in Item Name and Sale Price');
             return;
         }
         
         const newSale = {
             id: Date.now(),
             soldCode: soldCode,
             itemCode: 'DIRECT-' + Date.now().toString().slice(-6),
             itemName: itemName,
             itemType: itemType,
             weight: weight,
             karat: karat,
             salePrice: parseFloat(salePrice),
             profit: parseFloat(salePrice),
             saleDate: new Date().toISOString().split('T')[0]
         };
         
         soldItems.push(newSale);
         localStorage.setItem('soldItems', JSON.stringify(soldItems));
         
         // Add to cash in
         addToCashIn('Sold - ' + itemName, salePrice);
         
         // Clear form
         document.getElementById('sold-item-code').value = 'S-';
         document.getElementById('sold-item-name').value = '';
         document.getElementById('sold-weight').value = '';
         document.getElementById('sold-karat').value = '';
         document.getElementById('sale-price').value = '';
         
         alert('Sale recorded successfully!');
         loadDashboard();
     }

     // ==================== GOLD PURCHASES ====================
     function addGoldPurchase() {
         const goldCode = document.getElementById('gold-code').value;
         const weight = document.getElementById('gold-weight').value;
         const karat = document.getElementById('gold-karat').value;
         const pricePerGram = document.getElementById('gold-price-per-gram').value;
         
         if (!weight || !pricePerGram) {
             alert('Please fill in Weight and Price per Gram');
             return;
         }
         
         const totalAmount = parseFloat(weight) * parseFloat(pricePerGram);
         
         const newPurchase = {
             id: Date.now(),
             goldCode: goldCode,
             weight: parseFloat(weight),
             karat: karat,
             pricePerGram: parseFloat(pricePerGram),
             totalAmount: totalAmount,
             purchaseDate: new Date().toISOString().split('T')[0]
         };
         
         goldPurchases.push(newPurchase);
         localStorage.setItem('goldPurchases', JSON.stringify(goldPurchases));
         
         // Add to cash out
         addToCashOut('Gold Purchase - ' + goldCode, totalAmount);
         
         // Clear form
         document.getElementById('gold-weight').value = '';
         document.getElementById('gold-karat').value = '';
         document.getElementById('gold-price-per-gram').value = '';
         
         alert('Gold purchase recorded! Total: ‚Ç±' + totalAmount.toFixed(2));
         loadDashboard();
     }

     // ==================== SILVER PURCHASES ====================
     function addSilverPurchase() {
         const silverCode = document.getElementById('silver-code').value;
         const weight = document.getElementById('silver-weight').value;
         const pricePerGram = document.getElementById('silver-price-per-gram').value;
         
         if (!weight || !pricePerGram) {
             alert('Please fill in Weight and Price per Gram');
             return;
         }
         
         const totalAmount = parseFloat(weight) * parseFloat(pricePerGram);
         
         const newPurchase = {
             id: Date.now(),
             silverCode: silverCode,
             weight: parseFloat(weight),
             pricePerGram: parseFloat(pricePerGram),
             totalAmount: totalAmount,
             purchaseDate: new Date().toISOString().split('T')[0]
         };
         
         silverPurchases.push(newPurchase);
         localStorage.setItem('silverPurchases', JSON.stringify(silverPurchases));
         
         // Add to cash out
         addToCashOut('Silver Purchase - ' + silverCode, totalAmount);
         
         // Clear form
         document.getElementById('silver-weight').value = '';
         document.getElementById('silver-price-per-gram').value = '';
         
         alert('Silver purchase recorded! Total: ‚Ç±' + totalAmount.toFixed(2));
         loadDashboard();
     }

     // ==================== DASHBOARD FUNCTIONS ====================
     function loadDashboard() {
         const activePawns = pawnItems.filter(item => item.status === 'Active').length;
         const todaySales = soldItems.reduce((sum, item) => sum + item.salePrice, 0);
         const todayPurchases = goldPurchases.reduce((sum, item) => sum + item.totalAmount, 0) +
                              silverPurchases.reduce((sum, item) => sum + item.totalAmount, 0);
         
         document.getElementById('active-pawns').textContent = activePawns;
         document.getElementById('today-sales').textContent = '‚Ç±' + todaySales.toFixed(2);
         document.getElementById('today-purchases').textContent = '‚Ç±' + todayPurchases.toFixed(2);
         document.getElementById('active-count').textContent = activePawns + ' items';
     }

     function showSection(sectionName) {
         // Scroll to section
         const sections = {
             'cash-flow': 'cash-flow-section',
             'prenda': 'prenda-section',
             'renew': 'renew-section',
             'sold': 'sold-section'
         };
         
         const sectionId = sections[sectionName];
         if (sectionId) {
             document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
         }
     }

     // ==================== REPORT FUNCTIONS ====================
     function generateDailyReport() {
         const activePawns = pawnItems.filter(item => item.status === 'Active');
         const today = new Date().toISOString().split('T')[0];
         
         let totalSales = soldItems.reduce((sum, item) => sum + item.salePrice, 0);
         let totalRenewals = renewTransactions.reduce((sum, item) => sum + item.renewAmount, 0);
         let totalPurchases = goldPurchases.reduce((sum, item) => sum + item.totalAmount, 0) +
                            silverPurchases.reduce((sum, item) => sum + item.totalAmount, 0);
         
         let totalCashIn = 0;
         document.querySelectorAll('.cash-in-amount').forEach(input => {
             totalCashIn += parseFloat(input.value) || 0;
         });
         
         let totalCashOut = 0;
         document.querySelectorAll('.cash-out-amount').forEach(input => {
             totalCashOut += parseFloat(input.value) || 0;
         });
         
         const openingBalance = parseFloat(document.getElementById('opening-balance').value) || 0;
         const closingBalance = openingBalance + totalCashIn - totalCashOut;
         
         const reportHTML = `
             <h3 style="color: #2c3e50; margin-bottom: 20px;">üìä Daily Report - ${today}</h3>
             
             <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                 <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                     <h4 style="margin-bottom: 10px;">üí∞ Cash Summary</h4>
                     <p>Opening Balance: <strong>‚Ç±${openingBalance.toFixed(2)}</strong></p>
                     <p>Total Cash In: <strong class="positive">‚Ç±${totalCashIn.toFixed(2)}</strong></p>
                     <p>Total Cash Out: <strong class="negative">‚Ç±${totalCashOut.toFixed(2)}</strong></p>
                     <p>Closing Balance: <strong>‚Ç±${closingBalance.toFixed(2)}</strong></p>
                 </div>
                 
                 <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                     <h4 style="margin-bottom: 10px;">üìà Transactions Summary</h4>
                     <p>Active Pawns: <strong>${activePawns.length}</strong></p>
                     <p>Total Sales: <strong class="positive">‚Ç±${totalSales.toFixed(2)}</strong></p>
                     <p>Total Renewals: <strong class="positive">‚Ç±${totalRenewals.toFixed(2)}</strong></p>
                     <p>Total Purchases: <strong class="negative">‚Ç±${totalPurchases.toFixed(2)}</strong></p>
                 </div>
             </div>
             
             <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                 <h4 style="margin-bottom: 10px;">üìã Recent Transactions</h4>
                 <p>‚Ä¢ New Pawns Today: ${pawnItems.filter(item => item.pawnDate === today).length}</p>
                 <p>‚Ä¢ Renewals Today: ${renewTransactions.filter(item => item.renewDate === today).length}</p>
                 <p>‚Ä¢ Sales Today: ${soldItems.filter(item => item.saleDate === today).length}</p>
                 <p>‚Ä¢ Gold Purchases: ${goldPurchases.filter(item => item.purchaseDate === today).length}</p>
                 <p>‚Ä¢ Silver Purchases: ${silverPurchases.filter(item => item.purchaseDate === today).length}</p>
             </div>
         `;
         
         document.getElementById('report-results').innerHTML = reportHTML;
     }

     function printReport() {
         window.print();
     }

     function clearTodayData() {
         if (confirm('Are you sure you want to clear all cash transactions for today? This will reset cash flow entries but keep item records.')) {
             // Clear cash transactions
             document.getElementById('cash-in-container').innerHTML = '';
             document.getElementById('cash-out-container').innerHTML = '';
             
             // Reset cash arrays
             cashInTransactions = [];
             cashOutTransactions = [];
             localStorage.setItem('cashInTransactions', JSON.stringify(cashInTransactions));
             localStorage.setItem('cashOutTransactions', JSON.stringify(cashOutTransactions));
             
             // Add default rows back
             addCashInRow();
             addCashInRow();
             addCashOutRow();
             addCashOutRow();
             
             calculateTotals();
             alert('Today\'s cash data cleared!');
         }
     }

     // ==================== UTILITY FUNCTIONS ====================
     function setupEventListeners() {
         // Auto-calculate gold total
         document.getElementById('gold-weight').addEventListener('input', calculateGoldTotal);
         document.getElementById('gold-price-per-gram').addEventListener('input', calculateGoldTotal);
         
         // Auto-calculate silver total
         document.getElementById('silver-weight').addEventListener('input', calculateSilverTotal);
         document.getElementById('silver-price-per-gram').addEventListener('input', calculateSilverTotal);
         
         // Auto-update totals when opening balance changes
         document.getElementById('opening-balance').addEventListener('input', calculateTotals);
         
         // Auto-save cash transactions
         document.getElementById('cash-in-container').addEventListener('input', saveCashTransactions);
         document.getElementById('cash-out-container').addEventListener('input', saveCashTransactions);
     }

     function calculateGoldTotal() {
         const weight = parseFloat(document.getElementById('gold-weight').value) || 0;
         const price = parseFloat(document.getElementById('gold-price-per-gram').value) || 0;
         const total = weight * price;
         document.getElementById('gold-total-amount').value = total.toFixed(2);
     }

     function calculateSilverTotal() {
         const weight = parseFloat(document.getElementById('silver-weight').value) || 0;
         const price = parseFloat(document.getElementById('silver-price-per-gram').value) || 0;
         const total = weight * price;
         document.getElementById('silver-total-amount').value = total.toFixed(2);
     }

     function saveCashTransactions() {
         // Save cash in transactions
         const cashInRows = document.querySelectorAll('#cash-in-container .transaction-row');
         cashInTransactions = [];
         cashInRows.forEach(row => {
             const desc = row.querySelector('.cash-in-desc').value;
             const amount = parseFloat(row.querySelector('.cash-in-amount').value) || 0;
             if (desc && amount > 0) {
                 cashInTransactions.push({ description: desc, amount: amount });
             }
         });
         localStorage.setItem('cashInTransactions', JSON.stringify(cashInTransactions));
         
         // Save cash out transactions
         const cashOutRows = document.querySelectorAll('#cash-out-container .transaction-row');
         cashOutTransactions = [];
         cashOutRows.forEach(row => {
             const desc = row.querySelector('.cash-out-desc').value;
             const amount = parseFloat(row.querySelector('.cash-out-amount').value) || 0;
             if (desc && amount > 0) {
                 cashOutTransactions.push({ description: desc, amount: amount });
             }
         });
         localStorage.setItem('cashOutTransactions', JSON.stringify(cashOutTransactions));
     }
 </script>
</body>
</html>
