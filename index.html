<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sampan Pawnshop and Jewelry - Complete Inventory & Transaction System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: #f5f7fa;
            color: #333;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        h1 {
            color: white;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        .shop-name {
            color: #f39c12;
            font-weight: bold;
            font-size: 1.4em;
            margin-bottom: 15px;
        }
        .nav-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
        .nav-tab {
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .nav-tab.active {
            background: #f39c12;
            color: #2c3e50;
            font-weight: bold;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .dashboard-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        .dashboard-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .card-title {
            font-size: 1.2rem;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .main-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        .section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            height: fit-content;
        }
        .section-title {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #444;
            font-size: 0.9em;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.95rem;
            transition: border 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 15px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th {
            background-color: #f8f9fa;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #ddd;
            position: sticky;
            top: 0;
        }
        
        td {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-success {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-warning {
            background-color: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #d68910;
        }
        
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-info {
            background-color: #17a2b8;
            color: white;
        }
        
        .btn-info:hover {
            background-color: #138496;
        }
        
        .status-active {
            background: #2ecc71;
            color: white;
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 0.85em;
            display: inline-block;
        }
        
        .status-expired {
            background: #f39c12;
            color: white;
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 0.85em;
            display: inline-block;
        }
        
        .status-redeemed {
            background: #3498db;
            color: white;
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 0.85em;
            display: inline-block;
        }
        
        .status-foreclosed {
            background: #e74c3c;
            color: white;
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 0.85em;
            display: inline-block;
        }
        
        .positive {
            color: #2ecc71;
            font-weight: bold;
        }
        
        .negative {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .search-box {
            margin-bottom: 20px;
        }
        
        .search-box input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 100%;
        }
        
        .data-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .export-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .inventory-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid transparent;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border-color: #bee5eb;
        }
        
        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
            border-color: #ffeeba;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            color: #7f8c8d;
            font-size: 0.9rem;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }
        
        .small-btn {
            padding: 5px 10px !important;
            font-size: 0.8em !important;
            margin: 2px !important;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                padding: 10px;
                background: white;
            }
            
            .section {
                box-shadow: none;
                border: 1px solid #ddd;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Sampan Pawn Shop Management System</h1>
            <div class="shop-name">üìä Complete Inventory & Transaction Tracking</div>
            
            <div class="nav-tabs">
                <div class="nav-tab active" onclick="showTab('daily')">üìÖ Daily Operations</div>
                <div class="nav-tab" onclick="showTab('inventory')">üì¶ Inventory Management</div>
                <div class="nav-tab" onclick="showTab('transactions')">üíº Transaction History</div>
                <div class="nav-tab" onclick="showTab('customers')">üë• Customer Database</div>
                <div class="nav-tab" onclick="showTab('reports')">üìä Reports & Analytics</div>
                <div class="nav-tab" onclick="showTab('data')">üíæ Data Management</div>
            </div>
        </header>
        
        <!-- Daily Operations Tab -->
        <div id="daily-tab" class="tab-content active">
            <div class="dashboard-container">
                <div class="dashboard-card">
                    <div class="card-title">üìä Today's Overview</div>
                    <div class="summary-item">
                        <span>Date:</span>
                        <strong id="current-date"></strong>
                    </div>
                    <div class="summary-item">
                        <span>Active Pawns:</span>
                        <strong id="active-pawns-today">0</strong>
                    </div>
                    <div class="summary-item">
                        <span>Expiring Today:</span>
                        <strong class="negative" id="expiring-today">0</strong>
                    </div>
                    <div class="summary-item">
                        <span>Today's Cash Flow:</span>
                        <strong id="today-cash-flow">‚Ç±0.00</strong>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-title">‚ö° Quick Actions</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <button class="btn btn-warning" onclick="showModal('new-pawn-modal')">üìù New Pawn</button>
                        <button class="btn btn-success" onclick="showModal('lukat-modal')">üíµ Process Lukat</button>
                        <button class="btn btn-danger" onclick="showModal('remate-modal')">‚öñÔ∏è Process Remate</button>
                        <button class="btn btn-primary" onclick="showModal('renew-modal')">üîÑ Renew</button>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-title">üí∞ Cash Position</div>
                    <div class="summary-item">
                        <span>Opening Balance:</span>
                        <strong>‚Ç±<input type="number" id="opening-balance" value="10000" style="width: 120px; border: none; text-align: right; font-weight: bold;"></strong>
                    </div>
                    <div class="summary-item">
                        <span>Cash In Today:</span>
                        <strong class="positive" id="cash-in-today">‚Ç±0.00</strong>
                    </div>
                    <div class="summary-item">
                        <span>Cash Out Today:</span>
                        <strong class="negative" id="cash-out-today">‚Ç±0.00</strong>
                    </div>
                    <div class="summary-item">
                        <span>Closing Balance:</span>
                        <strong id="closing-balance">‚Ç±10,000.00</strong>
                    </div>
                </div>
            </div>
            
            <div class="main-container">
                <!-- Today's Transactions -->
                <div class="section">
                    <div class="section-title">
                        <span>üìã Today's Transactions</span>
                    </div>
                    <div class="table-container">
                        <table id="today-transactions-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Type</th>
                                    <th>Code</th>
                                    <th>Description</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Transactions will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Items Needing Attention -->
                <div class="section">
                    <div class="section-title">
                        <span>‚ö†Ô∏è Items Needing Attention</span>
                    </div>
                    <div class="table-container">
                        <table id="attention-items-table">
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>Item</th>
                                    <th>Status</th>
                                    <th>Due Date</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Items will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Inventory Management Tab -->
        <div id="inventory-tab" class="tab-content">
            <div class="inventory-stats">
                <div class="stat-card">
                    <div class="stat-label">Total Items</div>
                    <div class="stat-value" id="total-items">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Active Pawns</div>
                    <div class="stat-value" id="inventory-active">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Foreclosed Items</div>
                    <div class="stat-value" id="foreclosed-items">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Value</div>
                    <div class="stat-value" id="total-value">‚Ç±0.00</div>
                </div>
            </div>
            
            <div class="search-box">
                <input type="text" id="inventory-search" placeholder="üîç Search items by code, name, or customer..." onkeyup="searchInventory()">
            </div>
            
            <div class="section">
                <div class="section-title">
                    <span>üì¶ Complete Inventory</span>
                    <select id="inventory-filter" onchange="filterInventory()">
                        <option value="all">All Items</option>
                        <option value="active">Active Pawns</option>
                        <option value="expired">Expired</option>
                        <option value="redeemed">Redeemed</option>
                        <option value="foreclosed">Foreclosed</option>
                        <option value="auctioned">Auctioned</option>
                    </select>
                </div>
                <div class="table-container">
                    <table id="inventory-table">
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Item</th>
                                <th>Type</th>
                                <th>Customer</th>
                                <th>Pawn Amount</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Inventory items will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Transaction History Tab -->
        <div id="transactions-tab" class="tab-content">
            <div class="section">
                <div class="section-title">
                    <span>üíº All Transactions</span>
                    <div>
                        <input type="date" id="transactions-date" onchange="loadTransactions()">
                        <select id="transactions-type" onchange="loadTransactions()">
                            <option value="all">All Types</option>
                            <option value="pawn">New Pawn</option>
                            <option value="renew">Renewal</option>
                            <option value="lukat">Lukat</option>
                            <option value="remate">Remate</option>
                            <option value="sale">Sale</option>
                        </select>
                    </div>
                </div>
                <div class="table-container">
                    <table id="transactions-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Code</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Customer</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- All transactions will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Customer Database Tab -->
        <div id="customers-tab" class="tab-content">
            <div class="section">
                <div class="section-title">
                    <span>üë• Customer Database</span>
                    <button class="btn btn-primary" onclick="showModal('new-customer-modal')">+ Add Customer</button>
                </div>
                <div class="search-box">
                    <input type="text" id="customer-search" placeholder="üîç Search customers by name or contact..." onkeyup="searchCustomers()">
                </div>
                <div class="table-container">
                    <table id="customers-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Contact</th>
                                <th>Address</th>
                                <th>Active Pawns</th>
                                <th>Total Transactions</th>
                                <th>Last Visit</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Customers will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Reports & Analytics Tab -->
        <div id="reports-tab" class="tab-content">
            <div class="dashboard-container">
                <div class="dashboard-card">
                    <div class="card-title">üìà Financial Reports</div>
                    <button class="btn btn-primary" onclick="generateFinancialReport()" style="width: 100%; margin-bottom: 10px;">Generate Financial Report</button>
                    <button class="btn btn-success" onclick="generateInventoryReport()" style="width: 100%; margin-bottom: 10px;">Generate Inventory Report</button>
                    <button class="btn btn-warning" onclick="generateRemateReport()" style="width: 100%;">Generate Remate Report</button>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-title">üìÖ Date Range Reports</div>
                    <div class="form-group">
                        <label>From Date</label>
                        <input type="date" id="report-from-date">
                    </div>
                    <div class="form-group">
                        <label>To Date</label>
                        <input type="date" id="report-to-date">
                    </div>
                    <button class="btn btn-info" onclick="generateDateRangeReport()" style="width: 100%;">Generate Custom Report</button>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <span>üìä Report Results</span>
                </div>
                <div id="report-results" style="min-height: 400px; padding: 20px; background: #f8f9fa; border-radius: 5px;">
                    <div style="text-align: center; color: #7f8c8d;">
                        Select a report to generate
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Data Management Tab -->
        <div id="data-tab" class="tab-content">
            <div class="section">
                <div class="section-title">
                    <span>üíæ Data Management & GitHub Backup</span>
                </div>
                
                <div class="alert alert-success" id="data-status">
                    Data is stored locally in your browser
                </div>
                
                <div class="data-actions">
                    <button class="btn btn-primary" onclick="backupData()">üíæ Backup All Data</button>
                    <button class="btn btn-warning" onclick="showModal('restore-modal')">üì• Restore Data</button>
                    <button class="btn btn-danger" onclick="clearOldData()">üóëÔ∏è Clear Old Data</button>
                </div>
                
                <div class="export-options">
                    <button class="btn btn-success" onclick="exportToJSON()">üì§ Export to JSON</button>
                    <button class="btn btn-info" onclick="exportToCSV()">üìä Export to CSV</button>
                    <button class="btn btn-warning" onclick="printAllData()">üñ®Ô∏è Print Summary</button>
                    <button class="btn btn-danger" onclick="showModal('import-modal')">üì• Import Data</button>
                </div>
                
                <div class="table-container" style="margin-top: 20px;">
                    <table>
                        <thead>
                            <tr>
                                <th>Data Type</th>
                                <th>Records</th>
                                <th>Last Updated</th>
                                <th>File Size</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="data-stats-table">
                            <!-- Data stats will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Sampan Pawn Shop Management System &copy; <span id="current-year"></span></p>
            <p style="margin-top: 10px; font-size: 0.9em; color: #95a5a6;">
                Data is stored locally in your browser. Regular backups are recommended.
            </p>
        </footer>
    </div>
    
    <!-- Modals -->
    <div id="new-pawn-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìù New Pawn Item</h3>
                <button class="close-modal" onclick="closeModal('new-pawn-modal')">√ó</button>
            </div>
            <div id="new-pawn-form">
                <!-- Form will be loaded by JavaScript -->
            </div>
        </div>
    </div>
    
    <div id="lukat-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üíµ Process Lukat (Redemption)</h3>
                <button class="close-modal" onclick="closeModal('lukat-modal')">√ó</button>
            </div>
            <div id="lukat-form">
                <!-- Form will be loaded by JavaScript -->
            </div>
        </div>
    </div>
    
    <div id="remate-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚öñÔ∏è Process Remate (Foreclosure)</h3>
                <button class="close-modal" onclick="closeModal('remate-modal')">√ó</button>
            </div>
            <div id="remate-form">
                <!-- Form will be loaded by JavaScript -->
            </div>
        </div>
    </div>
    
    <div id="renew-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üîÑ Renew Pawn Item</h3>
                <button class="close-modal" onclick="closeModal('renew-modal')">√ó</button>
            </div>
            <div id="renew-form">
                <!-- Form will be loaded by JavaScript -->
            </div>
        </div>
    </div>
    
    <div id="new-customer-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üë• Add New Customer</h3>
                <button class="close-modal" onclick="closeModal('new-customer-modal')">√ó</button>
            </div>
            <div id="new-customer-form">
                <!-- Form will be loaded by JavaScript -->
            </div>
        </div>
    </div>
    
    <div id="restore-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üì• Restore Data</h3>
                <button class="close-modal" onclick="closeModal('restore-modal')">√ó</button>
            </div>
            <div id="restore-form">
                <!-- Form will be loaded by JavaScript -->
            </div>
        </div>
    </div>
    
    <div id="import-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üì• Import Data</h3>
                <button class="close-modal" onclick="closeModal('import-modal')">√ó</button>
            </div>
            <div id="import-form">
                <!-- Form will be loaded by JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script>
        // ==================== DATA STORAGE STRUCTURE ====================
        const DATA_STRUCTURE = {
            version: "2.0",
            lastBackup: null,
            data: {
                // Core data
                pawnItems: [],          // All pawn items with full history
                customers: [],          // Customer database
                transactions: [],       // All financial transactions
                inventory: [],          // Current inventory (foreclosed items)
                
                // Additional tracking
                dailyLogs: [],          // Daily operation logs
                settings: {             // System settings
                    shopName: "Sampan Pawn Shop",
                    interestRate: 5,
                    termDays: 30,
                    backupFrequency: "daily"
                }
            }
        };

        // ==================== INITIALIZATION ====================
        let systemData = initializeSystemData();
        let currentDate = new Date().toISOString().split('T')[0];
        
        function initializeSystemData() {
            // Try to load from localStorage
            const savedData = localStorage.getItem('pawnshopData');
            
            if (savedData) {
                try {
                    const parsed = JSON.parse(savedData);
                    // Check if data structure needs migration
                    if (parsed.version !== DATA_STRUCTURE.version) {
                        return migrateData(parsed);
                    }
                    return parsed;
                } catch (e) {
                    console.error('Error parsing saved data:', e);
                    return createSampleData();
                }
            } else {
                return createSampleData();
            }
        }

        function createSampleData() {
            // Initialize with sample data for demonstration
            const newData = JSON.parse(JSON.stringify(DATA_STRUCTURE));
            newData.lastBackup = new Date().toISOString();
            
            // Add sample customers
            newData.data.customers = [
                {
                    id: "CUST-001",
                    name: "Juan Dela Cruz",
                    contact: "09171234567",
                    email: "juan@example.com",
                    address: "123 Main St, Manila",
                    idType: "Driver's License",
                    idNumber: "DL123456",
                    createdAt: currentDate,
                    totalTransactions: 3,
                    totalAmount: 25000,
                    lastVisit: currentDate,
                    notes: ""
                },
                {
                    id: "CUST-002",
                    name: "Maria Santos",
                    contact: "09221234567",
                    email: "maria@example.com",
                    address: "456 Oak St, Quezon City",
                    idType: "Passport",
                    idNumber: "PP789012",
                    createdAt: currentDate,
                    totalTransactions: 2,
                    totalAmount: 15000,
                    lastVisit: currentDate,
                    notes: ""
                }
            ];
            
            // Add sample pawn items
            const expiryDate1 = addDays(currentDate, 30);
            const expiryDate2 = addDays(currentDate, 15);
            
            newData.data.pawnItems = [
                {
                    id: "P-001",
                    itemCode: "P-001",
                    itemName: "Gold Ring 18k",
                    itemType: "Jewelry",
                    weight: 10.5,
                    karat: 18,
                    pawnAmount: 15000,
                    termDays: 30,
                    customerId: "CUST-001",
                    customerName: "Juan Dela Cruz",
                    pawnDate: currentDate,
                    expiryDate: expiryDate1,
                    status: "Active",
                    isRemate: false,
                    renewalCount: 0,
                    remarks: "With certificate",
                    transactionHistory: []
                },
                {
                    id: "P-002",
                    itemCode: "P-002",
                    itemName: "iPhone 13 Pro",
                    itemType: "Electronics",
                    pawnAmount: 20000,
                    termDays: 30,
                    customerId: "CUST-002",
                    customerName: "Maria Santos",
                    pawnDate: currentDate,
                    expiryDate: expiryDate2,
                    status: "Active",
                    isRemate: false,
                    renewalCount: 0,
                    remarks: "256GB, space gray",
                    transactionHistory: []
                },
                {
                    id: "P-003",
                    itemCode: "P-003",
                    itemName: "Laptop Dell XPS",
                    itemType: "Electronics",
                    pawnAmount: 30000,
                    termDays: 30,
                    customerId: "CUST-001",
                    customerName: "Juan Dela Cruz",
                    pawnDate: addDays(currentDate, -10),
                    expiryDate: addDays(currentDate, -5),
                    status: "Expired",
                    isRemate: false,
                    renewalCount: 0,
                    remarks: "16GB RAM, 512GB SSD",
                    transactionHistory: []
                }
            ];
            
            // Add sample transactions
            newData.data.transactions = [
                {
                    id: "TXN-001",
                    date: currentDate,
                    time: "09:30",
                    type: "pawn",
                    code: "P-001",
                    description: "New Pawn - Gold Ring",
                    amount: 15000,
                    customerId: "CUST-001",
                    customerName: "Juan Dela Cruz",
                    status: "completed"
                },
                {
                    id: "TXN-002",
                    date: currentDate,
                    time: "10:15",
                    type: "pawn",
                    code: "P-002",
                    description: "New Pawn - iPhone",
                    amount: 20000,
                    customerId: "CUST-002",
                    customerName: "Maria Santos",
                    status: "completed"
                },
                {
                    id: "TXN-003",
                    date: addDays(currentDate, -10),
                    time: "14:20",
                    type: "pawn",
                    code: "P-003",
                    description: "New Pawn - Laptop",
                    amount: 30000,
                    customerId: "CUST-001",
                    customerName: "Juan Dela Cruz",
                    status: "completed"
                }
            ];
            
            // Initialize empty inventory
            newData.data.inventory = [];
            
            saveSystemData(newData);
            return newData;
        }
        
        function migrateData(oldData) {
            // Simple migration logic
            const newData = JSON.parse(JSON.stringify(DATA_STRUCTURE));
            
            // Migrate old data to new structure
            if (oldData.data && oldData.data.pawnItems) newData.data.pawnItems = oldData.data.pawnItems;
            if (oldData.data && oldData.data.customers) newData.data.customers = oldData.data.customers;
            if (oldData.data && oldData.data.transactions) newData.data.transactions = oldData.data.transactions;
            if (oldData.data && oldData.data.inventory) newData.data.inventory = oldData.data.inventory;
            
            // Handle old structure
            if (oldData.pawnItems && !oldData.data) newData.data.pawnItems = oldData.pawnItems;
            if (oldData.customers && !oldData.data) newData.data.customers = oldData.customers;
            if (oldData.transactions && !oldData.data) newData.data.transactions = oldData.transactions;
            
            newData.lastBackup = oldData.lastBackup || new Date().toISOString();
            saveSystemData(newData);
            return newData;
        }
        
        function saveSystemData(data) {
            systemData = data;
            localStorage.setItem('pawnshopData', JSON.stringify(data, null, 2));
            updateDataStats();
        }
        
        function addDays(dateString, days) {
            const date = new Date(dateString);
            date.setDate(date.getDate() + days);
            return date.toISOString().split('T')[0];
        }
        
        // ==================== UI INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date
            document.getElementById('current-date').textContent = formatDateForDisplay(currentDate);
            document.getElementById('current-year').textContent = new Date().getFullYear();
            
            // Set default report dates
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('report-from-date').value = addDays(today, -30);
            document.getElementById('report-to-date').value = today;
            document.getElementById('transactions-date').value = today;
            
            // Load initial data
            loadDailyOverview();
            loadTodayTransactions();
            loadAttentionItems();
            loadInventory();
            loadCustomers();
            updateDataStats();
            
            // Setup auto-save
            setInterval(autoSave, 30000);
            
            // Check for expired items
            checkExpiredItems();
        });
        
        function formatDateForDisplay(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // ==================== TAB MANAGEMENT ====================
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Refresh data for the tab
            switch(tabName) {
                case 'daily':
                    loadDailyOverview();
                    loadTodayTransactions();
                    loadAttentionItems();
                    break;
                case 'inventory':
                    loadInventory();
                    break;
                case 'transactions':
                    loadTransactions();
                    break;
                case 'customers':
                    loadCustomers();
                    break;
                case 'reports':
                    // Do nothing, wait for user action
                    break;
                case 'data':
                    updateDataStats();
                    break;
            }
        }
        
        // ==================== MODAL MANAGEMENT ====================
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            loadModalContent(modalId);
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function loadModalContent(modalId) {
            const formContainer = document.getElementById(modalId.replace('-modal', '-form'));
            
            switch(modalId) {
                case 'new-pawn-modal':
                    formContainer.innerHTML = `
                        <div class="form-group">
                            <label>Customer</label>
                            <select id="pawn-customer" onchange="loadCustomerDetails()">
                                <option value="">Select Customer</option>
                                ${systemData.data.customers.map(c => 
                                    `<option value="${c.id}">${c.name} (${c.id})</option>`
                                ).join('')}
                            </select>
                            <button class="btn btn-warning" onclick="showModal('new-customer-modal')" style="margin-top: 5px; width: 100%;">
                                + New Customer
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <label>Item Code</label>
                            <input type="text" id="pawn-item-code" value="P-" placeholder="P-001">
                        </div>
                        
                        <div class="form-group">
                            <label>Item Name/Description</label>
                            <input type="text" id="pawn-item-name" placeholder="e.g., Gold Ring, Laptop, etc.">
                        </div>
                        
                        <div class="form-group">
                            <label>Item Type</label>
                            <select id="pawn-item-type">
                                <option value="Jewelry">Jewelry</option>
                                <option value="Electronics">Electronics</option>
                                <option value="Appliances">Appliances</option>
                                <option value="Tools">Tools</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group">
                                <label>Weight (grams)</label>
                                <input type="number" id="pawn-weight" placeholder="0.00" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Karat (for gold)</label>
                                <input type="number" id="pawn-karat" placeholder="e.g., 18, 24">
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group">
                                <label>Pawn Amount (‚Ç±)</label>
                                <input type="number" id="pawn-amount" placeholder="0.00" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Term (Days)</label>
                                <select id="pawn-term">
                                    <option value="30">30 days</option>
                                    <option value="60">60 days</option>
                                    <option value="90">90 days</option>
                                    <option value="120">120 days</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Remarks</label>
                            <textarea id="pawn-remarks" placeholder="Additional notes..." rows="3"></textarea>
                        </div>
                        
                        <button class="btn btn-warning" style="width: 100%; padding: 12px;" onclick="processNewPawn()">
                            ‚úÖ Add Pawn Item
                        </button>
                    `;
                    break;
                    
                case 'lukat-modal':
                    const activeItems = systemData.data.pawnItems.filter(item => 
                        item.status === 'Active' || item.status === 'Expired'
                    );
                    
                    formContainer.innerHTML = `
                        <div class="form-group">
                            <label>Select Pawn Item</label>
                            <select id="lukat-item-select" onchange="loadLukatDetails()">
                                <option value="">Select Item</option>
                                ${activeItems.map(item => 
                                    `<option value="${item.id}">${item.itemCode} - ${item.itemName} (‚Ç±${item.pawnAmount.toFixed(2)})</option>`
                                ).join('')}
                            </select>
                        </div>
                        
                        <div id="lukat-details">
                            <!-- Details will be loaded here -->
                        </div>
                        
                        <button class="btn btn-success" style="width: 100%; padding: 12px;" onclick="processLukat()" id="process-lukat-btn" disabled>
                            üíµ Process Lukat
                        </button>
                    `;
                    break;
                    
                case 'remate-modal':
                    const expiredItems = systemData.data.pawnItems.filter(item => 
                        item.status === 'Expired'
                    );
                    
                    formContainer.innerHTML = `
                        <div class="form-group">
                            <label>Select Expired Item</label>
                            <select id="remate-item-select" onchange="loadRemateDetails()">
                                <option value="">Select Item</option>
                                ${expiredItems.map(item => 
                                    `<option value="${item.id}">${item.itemCode} - ${item.itemName} (Expired: ${item.expiryDate})</option>`
                                ).join('')}
                            </select>
                        </div>
                        
                        <div id="remate-details">
                            <!-- Details will be loaded here -->
                        </div>
                        
                        <button class="btn btn-danger" style="width: 100%; padding: 12px;" onclick="processRemate()" id="process-remate-btn" disabled>
                            ‚öñÔ∏è Process Remate
                        </button>
                    `;
                    break;
                    
                case 'new-customer-modal':
                    formContainer.innerHTML = `
                        <div class="form-group">
                            <label>Customer ID</label>
                            <input type="text" id="customer-id" value="CUST-" placeholder="CUST-001">
                        </div>
                        
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="customer-name" placeholder="Juan Dela Cruz">
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group">
                                <label>Contact Number</label>
                                <input type="text" id="customer-contact" placeholder="09171234567">
                            </div>
                            <div class="form-group">
                                <label>Email (Optional)</label>
                                <input type="email" id="customer-email" placeholder="email@example.com">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Address</label>
                            <textarea id="customer-address" placeholder="Full address..." rows="3"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Valid ID Type</label>
                            <select id="customer-id-type">
                                <option value="Driver's License">Driver's License</option>
                                <option value="Passport">Passport</option>
                                <option value="SSS/GSIS">SSS/GSIS</option>
                                <option value="Postal ID">Postal ID</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>ID Number</label>
                            <input type="text" id="customer-id-number" placeholder="ID Number">
                        </div>
                        
                        <button class="btn btn-primary" style="width: 100%; padding: 12px;" onclick="addNewCustomer()">
                            ‚úÖ Add Customer
                        </button>
                    `;
                    break;
            }
        }
        
        function loadCustomerDetails() {
            const customerId = document.getElementById('pawn-customer').value;
            if (customerId) {
                const customer = systemData.data.customers.find(c => c.id === customerId);
                // You can pre-fill customer details here if needed
            }
        }
        
        function loadLukatDetails() {
            const itemId = document.getElementById('lukat-item-select').value;
            const btn = document.getElementById('process-lukat-btn');
            
            if (itemId) {
                const item = systemData.data.pawnItems.find(i => i.id === itemId);
                if (item) {
                    const daysOverdue = calculateDaysOverdue(item.expiryDate);
                    const interestRate = 5; // Default 5% interest
                    const interestAmount = item.pawnAmount * (interestRate / 100);
                    const totalAmount = item.pawnAmount + interestAmount;
                    
                    document.getElementById('lukat-details').innerHTML = `
                        <div class="form-group">
                            <label>Item: <strong>${item.itemName}</strong></label>
                        </div>
                        <div class="form-group">
                            <label>Customer: <strong>${item.customerName}</strong></label>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group">
                                <label>Original Amount</label>
                                <input type="text" value="‚Ç±${item.pawnAmount.toFixed(2)}" readonly>
                            </div>
                            <div class="form-group">
                                <label>Days ${daysOverdue > 0 ? 'Overdue' : 'Remaining'}</label>
                                <input type="text" value="${Math.abs(daysOverdue)} days" readonly class="${daysOverdue > 0 ? 'negative' : 'positive'}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Interest Rate (%)</label>
                            <select id="lukat-interest-rate">
                                <option value="5" ${daysOverdue <= 0 ? 'selected' : ''}>5% (On time)</option>
                                <option value="7" ${daysOverdue > 0 && daysOverdue <= 7 ? 'selected' : ''}>7% (1-7 days late)</option>
                                <option value="10" ${daysOverdue > 7 ? 'selected' : ''}>10% (8+ days late)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Total to Pay (‚Ç±)</label>
                            <input type="number" id="lukat-total" value="${totalAmount.toFixed(2)}" readonly style="font-weight: bold; font-size: 1.1em;">
                        </div>
                        <div class="form-group">
                            <label>Payment Method</label>
                            <select id="lukat-payment-method">
                                <option value="cash">Cash</option>
                                <option value="gcash">GCash</option>
                                <option value="bank">Bank Transfer</option>
                            </select>
                        </div>
                    `;
                    btn.disabled = false;
                    
                    // Update total when interest rate changes
                    document.getElementById('lukat-interest-rate').addEventListener('change', function() {
                        const newRate = parseFloat(this.value);
                        const newTotal = item.pawnAmount + (item.pawnAmount * (newRate / 100));
                        document.getElementById('lukat-total').value = newTotal.toFixed(2);
                    });
                }
            } else {
                document.getElementById('lukat-details').innerHTML = '';
                btn.disabled = true;
            }
        }
        
        function loadRemateDetails() {
            const itemId = document.getElementById('remate-item-select').value;
            const btn = document.getElementById('process-remate-btn');
            
            if (itemId) {
                const item = systemData.data.pawnItems.find(i => i.id === itemId);
                if (item) {
                    const daysOverdue = calculateDaysOverdue(item.expiryDate);
                    const suggestedPrice = item.pawnAmount * 1.5; // 50% markup
                    
                    document.getElementById('remate-details').innerHTML = `
                        <div class="form-group">
                            <label>Item: <strong>${item.itemName}</strong></label>
                        </div>
                        <div class="form-group">
                            <label>Customer: <strong>${item.customerName}</strong></label>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group">
                                <label>Pawn Amount</label>
                                <input type="text" value="‚Ç±${item.pawnAmount.toFixed(2)}" readonly>
                            </div>
                            <div class="form-group">
                                <label>Days Overdue</label>
                                <input type="text" value="${daysOverdue} days" readonly class="negative">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Remate Type</label>
                            <select id="remate-type">
                                <option value="auction">Auction Sale</option>
                                <option value="direct">Direct Sale</option>
                                <option value="inventory">Add to Inventory</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Sale Price (‚Ç±)</label>
                            <input type="number" id="remate-price" value="${suggestedPrice.toFixed(2)}" step="0.01" placeholder="Sale price">
                        </div>
                        <div class="form-group">
                            <label>Buyer Information (if sold)</label>
                            <input type="text" id="remate-buyer" placeholder="Buyer name (optional)">
                        </div>
                        <div class="form-group">
                            <label>Remarks</label>
                            <textarea id="remate-remarks" placeholder="Remate details..." rows="3"></textarea>
                        </div>
                    `;
                    btn.disabled = false;
                }
            } else {
                document.getElementById('remate-details').innerHTML = '';
                btn.disabled = true;
            }
        }
        
        function calculateDaysOverdue(expiryDate) {
            const today = new Date(currentDate);
            const expiry = new Date(expiryDate);
            const diffTime = expiry - today;
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }
        
        // ==================== CORE BUSINESS LOGIC ====================
        function processNewPawn() {
            const customerId = document.getElementById('pawn-customer').value;
            const itemCode = document.getElementById('pawn-item-code').value;
            const itemName = document.getElementById('pawn-item-name').value;
            const itemType = document.getElementById('pawn-item-type').value;
            const weight = parseFloat(document.getElementById('pawn-weight').value) || 0;
            const karat = parseInt(document.getElementById('pawn-karat').value) || 0;
            const pawnAmount = parseFloat(document.getElementById('pawn-amount').value);
            const termDays = parseInt(document.getElementById('pawn-term').value);
            const remarks = document.getElementById('pawn-remarks').value;
            
            if (!customerId || !itemCode || !itemName || !pawnAmount) {
                alert('Please fill in all required fields');
                return;
            }
            
            const customer = systemData.data.customers.find(c => c.id === customerId);
            if (!customer) {
                alert('Customer not found');
                return;
            }
            
            // Check if item code already exists
            if (systemData.data.pawnItems.some(item => item.itemCode === itemCode)) {
                alert('Item code already exists. Please use a different code.');
                return;
            }
            
            // Create new pawn item
            const newItem = {
                id: itemCode,
                itemCode: itemCode,
                itemName: itemName,
                itemType: itemType,
                weight: weight,
                karat: karat,
                pawnAmount: pawnAmount,
                termDays: termDays,
                customerId: customerId,
                customerName: customer.name,
                pawnDate: currentDate,
                expiryDate: addDays(currentDate, termDays),
                status: "Active",
                isRemate: false,
                renewalCount: 0,
                remarks: remarks,
                transactionHistory: []
            };
            
            // Add to pawn items
            systemData.data.pawnItems.push(newItem);
            
            // Create transaction record
            const transaction = {
                id: 'TXN-' + Date.now(),
                date: currentDate,
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                type: 'pawn',
                code: itemCode,
                description: `New Pawn - ${itemName}`,
                amount: pawnAmount,
                customerId: customerId,
                customerName: customer.name,
                status: 'completed'
            };
            
            systemData.data.transactions.push(transaction);
            
            // Update customer stats
            customer.totalTransactions = (customer.totalTransactions || 0) + 1;
            customer.totalAmount = (customer.totalAmount || 0) + pawnAmount;
            customer.lastVisit = currentDate;
            
            // Save data
            saveSystemData(systemData);
            
            // Update cash position (cash out)
            updateCashPosition(-pawnAmount);
            
            // Close modal and refresh UI
            closeModal('new-pawn-modal');
            loadDailyOverview();
            loadTodayTransactions();
            loadAttentionItems();
            loadInventory();
            
            alert(`Pawn item added successfully!\nCode: ${itemCode}\nAmount: ‚Ç±${pawnAmount.toFixed(2)}\nExpiry: ${newItem.expiryDate}`);
        }
        
        function processLukat() {
            const itemId = document.getElementById('lukat-item-select').value;
            const interestRate = parseFloat(document.getElementById('lukat-interest-rate').value);
            const paymentMethod = document.getElementById('lukat-payment-method').value;
            
            if (!itemId) {
                alert('Please select an item');
                return;
            }
            
            const item = systemData.data.pawnItems.find(i => i.id === itemId);
            if (!item) {
                alert('Item not found');
                return;
            }
            
            // Calculate total amount
            const interestAmount = item.pawnAmount * (interestRate / 100);
            const totalAmount = item.pawnAmount + interestAmount;
            
            if (!confirm(`Process Lukat for ${item.itemCode}?\n\nPrincipal: ‚Ç±${item.pawnAmount.toFixed(2)}\nInterest (${interestRate}%): ‚Ç±${interestAmount.toFixed(2)}\nTotal: ‚Ç±${totalAmount.toFixed(2)}`)) {
                return;
            }
            
            // Update item status
            item.status = "Redeemed";
            item.redemptionDate = currentDate;
            item.redemptionAmount = totalAmount;
            
            // Add to transaction history
            item.transactionHistory.push({
                date: currentDate,
                type: 'lukat',
                amount: totalAmount,
                interestRate: interestRate
            });
            
            // Create transaction record
            const transaction = {
                id: 'TXN-' + Date.now(),
                date: currentDate,
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                type: 'lukat',
                code: item.itemCode,
                description: `Lukat - ${item.itemName}`,
                amount: totalAmount,
                customerId: item.customerId,
                customerName: item.customerName,
                interestRate: interestRate,
                paymentMethod: paymentMethod,
                status: 'completed'
            };
            
            systemData.data.transactions.push(transaction);
            
            // Update customer stats
            const customer = systemData.data.customers.find(c => c.id === item.customerId);
            if (customer) {
                customer.totalTransactions = (customer.totalTransactions || 0) + 1;
                customer.lastVisit = currentDate;
            }
            
            // Update cash position (cash in)
            updateCashPosition(totalAmount);
            
            // Save data
            saveSystemData(systemData);
            
            // Close modal and refresh UI
            closeModal('lukat-modal');
            loadDailyOverview();
            loadTodayTransactions();
            loadAttentionItems();
            loadInventory();
            
            alert(`Lukat processed successfully!\nTotal received: ‚Ç±${totalAmount.toFixed(2)}`);
        }
        
        function processRemate() {
            const itemId = document.getElementById('remate-item-select').value;
            const remateType = document.getElementById('remate-type').value;
            const salePrice = parseFloat(document.getElementById('remate-price').value);
            const buyer = document.getElementById('remate-buyer').value;
            const remarks = document.getElementById('remate-remarks').value;
            
            if (!itemId) {
                alert('Please select an item');
                return;
            }
            
            const item = systemData.data.pawnItems.find(i => i.id === itemId);
            if (!item) {
                alert('Item not found');
                return;
            }
            
            if (remateType !== 'inventory' && (!salePrice || salePrice <= 0)) {
                alert('Please enter a valid sale price');
                return;
            }
            
            if (!confirm(`Process Remate for ${item.itemCode}?\n\nType: ${remateType}\nSale Price: ‚Ç±${salePrice.toFixed(2)}\nProfit: ‚Ç±${(salePrice - item.pawnAmount).toFixed(2)}`)) {
                return;
            }
            
            // Update item based on remate type
            if (remateType === 'inventory') {
                item.status = "Foreclosed";
                item.remateDate = currentDate;
                item.inventoryValue = salePrice || item.pawnAmount;
                
                // Add to inventory
                systemData.data.inventory.push({
                    id: item.id,
                    itemCode: item.itemCode,
                    itemName: item.itemName,
                    itemType: item.itemType,
                    pawnAmount: item.pawnAmount,
                    inventoryValue: salePrice || item.pawnAmount,
                    dateAdded: currentDate,
                    status: 'in_inventory'
                });
            } else {
                item.status = "Auctioned";
                item.remateDate = currentDate;
                item.salePrice = salePrice;
                item.saleBuyer = buyer;
                item.saleProfit = salePrice - item.pawnAmount;
            }
            
            item.isRemate = true;
            item.remateType = remateType;
            item.remateRemarks = remarks;
            
            // Add to transaction history
            item.transactionHistory.push({
                date: currentDate,
                type: 'remate',
                remateType: remateType,
                amount: salePrice,
                buyer: buyer
            });
            
            // Create transaction record
            const transaction = {
                id: 'TXN-' + Date.now(),
                date: currentDate,
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                type: 'remate',
                code: item.itemCode,
                description: `Remate (${remateType}) - ${item.itemName}`,
                amount: salePrice,
                customerId: item.customerId,
                customerName: item.customerName,
                remateType: remateType,
                profit: salePrice - item.pawnAmount,
                status: 'completed'
            };
            
            systemData.data.transactions.push(transaction);
            
            // Update cash position if sold
            if (remateType !== 'inventory') {
                updateCashPosition(salePrice);
            }
            
            // Save data
            saveSystemData(systemData);
            
            // Close modal and refresh UI
            closeModal('remate-modal');
            loadDailyOverview();
            loadTodayTransactions();
            loadAttentionItems();
            loadInventory();
            
            alert(`Remate processed successfully!\nItem status: ${item.status}`);
        }
        
        function addNewCustomer() {
            const customerId = document.getElementById('customer-id').value;
            const name = document.getElementById('customer-name').value;
            const contact = document.getElementById('customer-contact').value;
            const email = document.getElementById('customer-email').value;
            const address = document.getElementById('customer-address').value;
            const idType = document.getElementById('customer-id-type').value;
            const idNumber = document.getElementById('customer-id-number').value;
            
            if (!customerId || !name || !contact || !address || !idNumber) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Check if customer ID already exists
            if (systemData.data.customers.some(c => c.id === customerId)) {
                alert('Customer ID already exists');
                return;
            }
            
            const newCustomer = {
                id: customerId,
                name: name,
                contact: contact,
                email: email || '',
                address: address,
                idType: idType,
                idNumber: idNumber,
                createdAt: currentDate,
                totalTransactions: 0,
                totalAmount: 0,
                lastVisit: currentDate,
                notes: ''
            };
            
            systemData.data.customers.push(newCustomer);
            saveSystemData(systemData);
            
            // Close modal
            closeModal('new-customer-modal');
            
            // Update customer dropdown in new pawn modal
            const customerSelect = document.getElementById('pawn-customer');
            if (customerSelect) {
                const option = document.createElement('option');
                option.value = newCustomer.id;
                option.textContent = `${newCustomer.name} (${newCustomer.id})`;
                customerSelect.appendChild(option);
            }
            
            // Refresh customers tab
            loadCustomers();
            
            alert('Customer added successfully!');
        }
        
        // ==================== DATA LOADING FUNCTIONS ====================
        function loadDailyOverview() {
            const today = currentDate;
            
            // Count active pawns
            const activePawns = systemData.data.pawnItems.filter(item => 
                item.status === 'Active'
            ).length;
            
            // Count items expiring today
            const expiringToday = systemData.data.pawnItems.filter(item => 
                item.status === 'Active' && item.expiryDate === today
            ).length;
            
            // Calculate today's cash flow
            const todayTransactions = systemData.data.transactions.filter(t => 
                t.date === today
            );
            
            const cashIn = todayTransactions
                .filter(t => t.type === 'lukat' || t.type === 'remate' || t.type === 'sale')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const cashOut = todayTransactions
                .filter(t => t.type === 'pawn')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const cashFlow = cashIn - cashOut;
            
            // Update UI
            document.getElementById('active-pawns-today').textContent = activePawns;
            document.getElementById('expiring-today').textContent = expiringToday;
            document.getElementById('today-cash-flow').textContent = `‚Ç±${cashFlow.toFixed(2)}`;
            document.getElementById('today-cash-flow').className = cashFlow >= 0 ? 'positive' : 'negative';
            
            // Update cash position
            document.getElementById('cash-in-today').textContent = `‚Ç±${cashIn.toFixed(2)}`;
            document.getElementById('cash-out-today').textContent = `‚Ç±${cashOut.toFixed(2)}`;
            
            const openingBalance = parseFloat(document.getElementById('opening-balance').value) || 0;
            const closingBalance = openingBalance + cashFlow;
            document.getElementById('closing-balance').textContent = `‚Ç±${closingBalance.toFixed(2)}`;
        }
        
        function loadTodayTransactions() {
            const today = currentDate;
            const tbody = document.getElementById('today-transactions-table').querySelector('tbody');
            const todayTransactions = systemData.data.transactions
                .filter(t => t.date === today)
                .sort((a, b) => {
                    // Sort by time if available, otherwise by date
                    if (a.time && b.time) {
                        return a.time.localeCompare(b.time);
                    }
                    return 0;
                });
            
            tbody.innerHTML = '';
            
            if (todayTransactions.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 20px; color: #7f8c8d;">
                            No transactions today
                        </td>
                    </tr>
                `;
                return;
            }
            
            todayTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                
                // Determine transaction type icon
                let typeIcon = '';
                let typeClass = '';
                switch(transaction.type) {
                    case 'pawn':
                        typeIcon = 'üìù';
                        typeClass = 'negative';
                        break;
                    case 'lukat':
                        typeIcon = 'üíµ';
                        typeClass = 'positive';
                        break;
                    case 'remate':
                        typeIcon = '‚öñÔ∏è';
                        typeClass = transaction.remateType === 'inventory' ? '' : 'positive';
                        break;
                    case 'renew':
                        typeIcon = 'üîÑ';
                        typeClass = 'positive';
                        break;
                    case 'sale':
                        typeIcon = 'üí∞';
                        typeClass = 'positive';
                        break;
                }
                
                row.innerHTML = `
                    <td>${transaction.time || '--:--'}</td>
                    <td>${typeIcon} ${transaction.type.toUpperCase()}</td>
                    <td><strong>${transaction.code}</strong></td>
                    <td>${transaction.description}</td>
                    <td class="${typeClass}">${transaction.type === 'pawn' ? '-' : '+'}‚Ç±${transaction.amount.toFixed(2)}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadAttentionItems() {
            const tbody = document.getElementById('attention-items-table').querySelector('tbody');
            const today = new Date(currentDate);
            
            // Find items needing attention
            const attentionItems = systemData.data.pawnItems.filter(item => {
                if (item.status === 'Active') {
                    const expiryDate = new Date(item.expiryDate);
                    const daysUntilExpiry = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
                    return daysUntilExpiry <= 3; // Items expiring in 3 days or less
                }
                return item.status === 'Expired';
            }).sort((a, b) => new Date(a.expiryDate) - new Date(b.expiryDate));
            
            tbody.innerHTML = '';
            
            if (attentionItems.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 20px; color: #7f8c8d;">
                            No items needing attention
                        </td>
                    </tr>
                `;
                return;
            }
            
            attentionItems.forEach(item => {
                const expiryDate = new Date(item.expiryDate);
                const daysUntilExpiry = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
                
                let statusText = '';
                let statusClass = '';
                let actionButton = '';
                
                if (item.status === 'Expired') {
                    statusText = 'EXPIRED';
                    statusClass = 'status-expired';
                    actionButton = `<button class="btn btn-danger small-btn" onclick="showModal('remate-modal')">Remate</button>`;
                } else if (daysUntilExpiry <= 0) {
                    statusText = 'TODAY';
                    statusClass = 'status-expired';
                    actionButton = `<button class="btn btn-warning small-btn" onclick="showModal('renew-modal')">Renew</button>`;
                } else {
                    statusText = `${daysUntilExpiry} DAYS`;
                    statusClass = daysUntilExpiry <= 2 ? 'status-expired' : 'status-active';
                    actionButton = `<button class="btn btn-success small-btn" onclick="showModal('lukat-modal')">Lukat</button>`;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${item.itemCode}</strong></td>
                    <td>${item.itemName}</td>
                    <td><span class="${statusClass}">${statusText}</span></td>
                    <td>${item.expiryDate}</td>
                    <td>${actionButton}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadInventory() {
            // Update stats
            const totalItems = systemData.data.pawnItems.length;
            const activePawns = systemData.data.pawnItems.filter(item => item.status === 'Active').length;
            const foreclosedItems = systemData.data.pawnItems.filter(item => item.status === 'Foreclosed').length;
            const totalValue = systemData.data.pawnItems.reduce((sum, item) => sum + item.pawnAmount, 0);
            
            document.getElementById('total-items').textContent = totalItems;
            document.getElementById('inventory-active').textContent = activePawns;
            document.getElementById('foreclosed-items').textContent = foreclosedItems;
            document.getElementById('total-value').textContent = `‚Ç±${totalValue.toFixed(2)}`;
            
            // Load inventory table
            const tbody = document.getElementById('inventory-table').querySelector('tbody');
            const filter = document.getElementById('inventory-filter').value;
            const searchTerm = document.getElementById('inventory-search').value.toLowerCase();
            
            let filteredItems = systemData.data.pawnItems;
            
            // Apply filter
            if (filter !== 'all') {
                filteredItems = filteredItems.filter(item => {
                    if (filter === 'active') return item.status === 'Active';
                    if (filter === 'expired') return item.status === 'Expired';
                    if (filter === 'redeemed') return item.status === 'Redeemed';
                    if (filter === 'foreclosed') return item.status === 'Foreclosed';
                    if (filter === 'auctioned') return item.status === 'Auctioned';
                    return true;
                });
            }
            
            // Apply search
            if (searchTerm) {
                filteredItems = filteredItems.filter(item => 
                    item.itemCode.toLowerCase().includes(searchTerm) ||
                    item.itemName.toLowerCase().includes(searchTerm) ||
                    item.customerName.toLowerCase().includes(searchTerm)
                );
            }
            
            // Sort by date (newest first)
            filteredItems.sort((a, b) => new Date(b.pawnDate) - new Date(a.pawnDate));
            
            tbody.innerHTML = '';
            
            if (filteredItems.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px; color: #7f8c8d;">
                            No items found
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredItems.forEach(item => {
                // Determine status badge
                let statusBadge = '';
                switch(item.status) {
                    case 'Active':
                        statusBadge = '<span class="status-active">ACTIVE</span>';
                        break;
                    case 'Expired':
                        statusBadge = '<span class="status-expired">EXPIRED</span>';
                        break;
                    case 'Redeemed':
                        statusBadge = '<span class="status-redeemed">REDEEMED</span>';
                        break;
                    case 'Foreclosed':
                        statusBadge = '<span class="status-foreclosed">FORECLOSED</span>';
                        break;
                    case 'Auctioned':
                        statusBadge = '<span class="status-foreclosed">AUCTIONED</span>';
                        break;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${item.itemCode}</strong></td>
                    <td>${item.itemName} ${item.weight ? `(${item.weight}g)` : ''}</td>
                    <td>${item.itemType}</td>
                    <td>${item.customerName}</td>
                    <td>‚Ç±${item.pawnAmount.toFixed(2)}</td>
                    <td>${statusBadge}</td>
                    <td>${item.pawnDate}</td>
                    <td>
                        <button class="btn btn-info small-btn" onclick="viewItemDetails('${item.id}')">View</button>
                        ${item.status === 'Active' ? `
                            <button class="btn btn-success small-btn" onclick="showModal('lukat-modal')">Lukat</button>
                        ` : ''}
                        ${item.status === 'Expired' ? `
                            <button class="btn btn-danger small-btn" onclick="showModal('remate-modal')">Remate</button>
                        ` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function searchInventory() {
            loadInventory();
        }
        
        function filterInventory() {
            loadInventory();
        }
        
        function loadTransactions() {
            const dateFilter = document.getElementById('transactions-date').value;
            const typeFilter = document.getElementById('transactions-type').value;
            const tbody = document.getElementById('transactions-table').querySelector('tbody');
            
            let filteredTransactions = systemData.data.transactions;
            
            // Apply date filter
            if (dateFilter) {
                filteredTransactions = filteredTransactions.filter(t => t.date === dateFilter);
            }
            
            // Apply type filter
            if (typeFilter !== 'all') {
                filteredTransactions = filteredTransactions.filter(t => t.type === typeFilter);
            }
            
            // Sort by date (newest first)
            filteredTransactions.sort((a, b) => {
                if (a.date !== b.date) {
                    return new Date(b.date) - new Date(a.date);
                }
                if (a.time && b.time) {
                    return b.time.localeCompare(a.time);
                }
                return 0;
            });
            
            tbody.innerHTML = '';
            
            if (filteredTransactions.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px; color: #7f8c8d;">
                            No transactions found
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredTransactions.forEach(transaction => {
                // Determine type icon
                let typeIcon = '';
                switch(transaction.type) {
                    case 'pawn': typeIcon = 'üìù'; break;
                    case 'lukat': typeIcon = 'üíµ'; break;
                    case 'remate': typeIcon = '‚öñÔ∏è'; break;
                    case 'renew': typeIcon = 'üîÑ'; break;
                    case 'sale': typeIcon = 'üí∞'; break;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${transaction.date} ${transaction.time ? transaction.time : ''}</td>
                    <td>${typeIcon} ${transaction.type.toUpperCase()}</td>
                    <td><strong>${transaction.code}</strong></td>
                    <td>${transaction.description}</td>
                    <td class="${transaction.type === 'pawn' ? 'negative' : 'positive'}">
                        ${transaction.type === 'pawn' ? '-' : '+'}‚Ç±${transaction.amount.toFixed(2)}
                    </td>
                    <td>${transaction.customerName}</td>
                    <td>
                        <button class="btn btn-info small-btn" onclick="viewTransactionDetails('${transaction.id}')">
                            Details
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadCustomers() {
            const tbody = document.getElementById('customers-table').querySelector('tbody');
            const searchTerm = document.getElementById('customer-search').value.toLowerCase();
            
            let filteredCustomers = systemData.data.customers;
            
            // Apply search
            if (searchTerm) {
                filteredCustomers = filteredCustomers.filter(customer =>
                    customer.name.toLowerCase().includes(searchTerm) ||
                    customer.contact.includes(searchTerm) ||
                    customer.id.toLowerCase().includes(searchTerm)
                );
            }
            
            // Sort by last visit (most recent first)
            filteredCustomers.sort((a, b) => new Date(b.lastVisit) - new Date(a.lastVisit));
            
            tbody.innerHTML = '';
            
            if (filteredCustomers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px; color: #7f8c8d;">
                            No customers found
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredCustomers.forEach(customer => {
                // Count active pawns for this customer
                const activePawns = systemData.data.pawnItems.filter(item => 
                    item.customerId === customer.id && item.status === 'Active'
                ).length;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${customer.id}</strong></td>
                    <td>${customer.name}</td>
                    <td>${customer.contact}</td>
                    <td>${customer.address.substring(0, 30)}${customer.address.length > 30 ? '...' : ''}</td>
                    <td>${activePawns}</td>
                    <td>${customer.totalTransactions || 0}</td>
                    <td>${customer.lastVisit}</td>
                    <td>
                        <button class="btn btn-info small-btn" onclick="viewCustomerDetails('${customer.id}')">
                            View
                        </button>
                        <button class="btn btn-primary small-btn" onclick="editCustomer('${customer.id}')">
                            Edit
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function searchCustomers() {
            loadCustomers();
        }
        
        // ==================== REPORT FUNCTIONS ====================
        function generateFinancialReport() {
            const fromDate = document.getElementById('report-from-date').value;
            const toDate = document.getElementById('report-to-date').value;
            
            if (!fromDate || !toDate) {
                alert('Please select date range');
                return;
            }
            
            const filteredTransactions = systemData.data.transactions.filter(t => 
                t.date >= fromDate && t.date <= toDate
            );
            
            const summary = {
                totalTransactions: filteredTransactions.length,
                totalPawn: filteredTransactions.filter(t => t.type === 'pawn').reduce((sum, t) => sum + t.amount, 0),
                totalLukat: filteredTransactions.filter(t => t.type === 'lukat').reduce((sum, t) => sum + t.amount, 0),
                totalRemate: filteredTransactions.filter(t => t.type === 'remate').reduce((sum, t) => sum + t.amount, 0),
                totalRenew: filteredTransactions.filter(t => t.type === 'renew').reduce((sum, t) => sum + t.amount, 0),
                totalSale: filteredTransactions.filter(t => t.type === 'sale').reduce((sum, t) => sum + t.amount, 0),
                
                // Calculate profits
                remateProfit: filteredTransactions.filter(t => t.type === 'remate').reduce((sum, t) => sum + (t.profit || 0), 0),
                saleProfit: filteredTransactions.filter(t => t.type === 'sale').reduce((sum, t) => sum + (t.profit || 0), 0)
            };
            
            const netCashFlow = summary.totalLukat + summary.totalRemate + summary.totalRenew + summary.totalSale - summary.totalPawn;
            
            const reportHTML = `
                <h3>üìà Financial Report: ${fromDate} to ${toDate}</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div style="background: #e8f4fc; padding: 15px; border-radius: 5px;">
                        <h4>üí∞ Cash Inflows</h4>
                        <p>Lukat (Redemptions): <strong class="positive">‚Ç±${summary.totalLukat.toFixed(2)}</strong></p>
                        <p>Remate Sales: <strong class="positive">‚Ç±${summary.totalRemate.toFixed(2)}</strong></p>
                        <p>Renewals: <strong class="positive">‚Ç±${summary.totalRenew.toFixed(2)}</strong></p>
                        <p>Direct Sales: <strong class="positive">‚Ç±${summary.totalSale.toFixed(2)}</strong></p>
                        <hr>
                        <p><strong>Total Cash In: ‚Ç±${(summary.totalLukat + summary.totalRemate + summary.totalRenew + summary.totalSale).toFixed(2)}</strong></p>
                    </div>
                    
                    <div style="background: #fce8e8; padding: 15px; border-radius: 5px;">
                        <h4>üí∏ Cash Outflows</h4>
                        <p>New Pawns: <strong class="negative">‚Ç±${summary.totalPawn.toFixed(2)}</strong></p>
                        <hr>
                        <p><strong>Total Cash Out: ‚Ç±${summary.totalPawn.toFixed(2)}</strong></p>
                    </div>
                </div>
                
                <div style="background: #f0f8f0; padding: 15px; border-radius: 5px; margin: 20px 0;">
                    <h4>üìä Summary</h4>
                    <p>Net Cash Flow: <strong class="${netCashFlow >= 0 ? 'positive' : 'negative'}">‚Ç±${netCashFlow.toFixed(2)}</strong></p>
                    <p>Remate Profit: <strong class="positive">‚Ç±${summary.remateProfit.toFixed(2)}</strong></p>
                    <p>Sales Profit: <strong class="positive">‚Ç±${summary.saleProfit.toFixed(2)}</strong></p>
                    <p>Total Profit: <strong class="positive">‚Ç±${(summary.remateProfit + summary.saleProfit).toFixed(2)}</strong></p>
                </div>
                
                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                    <h4>üìã Transaction Count</h4>
                    <p>Total Transactions: <strong>${summary.totalTransactions}</strong></p>
                    <p>New Pawns: ${filteredTransactions.filter(t => t.type === 'pawn').length}</p>
                    <p>Lukat: ${filteredTransactions.filter(t => t.type === 'lukat').length}</p>
                    <p>Remate: ${filteredTransactions.filter(t => t.type === 'remate').length}</p>
                    <p>Renewals: ${filteredTransactions.filter(t => t.type === 'renew').length}</p>
                    <p>Sales: ${filteredTransactions.filter(t => t.type === 'sale').length}</p>
                </div>
            `;
            
            document.getElementById('report-results').innerHTML = reportHTML;
        }
        
        function generateInventoryReport() {
            const today = new Date();
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(today.getDate() - 30);
            
            const activeItems = systemData.data.pawnItems.filter(item => item.status === 'Active');
            const expiredItems = systemData.data.pawnItems.filter(item => item.status === 'Expired');
            const foreclosedItems = systemData.data.pawnItems.filter(item => item.status === 'Foreclosed');
            const auctionedItems = systemData.data.pawnItems.filter(item => item.status === 'Auctioned');
            
            const recentItems = systemData.data.pawnItems.filter(item => 
                new Date(item.pawnDate) >= thirtyDaysAgo
            );
            
            const reportHTML = `
                <h3>üì¶ Inventory Report</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div style="background: #e8f4fc; padding: 15px; border-radius: 5px; text-align: center;">
                        <h4>Active Pawns</h4>
                        <div style="font-size: 2rem; font-weight: bold;">${activeItems.length}</div>
                        <div>‚Ç±${activeItems.reduce((sum, item) => sum + item.pawnAmount, 0).toFixed(2)}</div>
                    </div>
                    
                    <div style="background: #fff8e8; padding: 15px; border-radius: 5px; text-align: center;">
                        <h4>Expired Items</h4>
                        <div style="font-size: 2rem; font-weight: bold;" class="negative">${expiredItems.length}</div>
                        <div>‚Ç±${expiredItems.reduce((sum, item) => sum + item.pawnAmount, 0).toFixed(2)}</div>
                    </div>
                    
                    <div style="background: #fce8e8; padding: 15px; border-radius: 5px; text-align: center;">
                        <h4>Foreclosed</h4>
                        <div style="font-size: 2rem; font-weight: bold;">${foreclosedItems.length}</div>
                        <div>‚Ç±${foreclosedItems.reduce((sum, item) => sum + item.pawnAmount, 0).toFixed(2)}</div>
                    </div>
                    
                    <div style="background: #f0f8f0; padding: 15px; border-radius: 5px; text-align: center;">
                        <h4>Auctioned</h4>
                        <div style="font-size: 2rem; font-weight: bold;">${auctionedItems.length}</div>
                        <div>‚Ç±${auctionedItems.reduce((sum, item) => sum + (item.salePrice || 0), 0).toFixed(2)}</div>
                    </div>
                </div>
                
                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 20px 0;">
                    <h4>üìã Items by Type</h4>
                    <table style="width: 100%;">
                        <thead>
                            <tr>
                                <th>Item Type</th>
                                <th>Count</th>
                                <th>Total Value</th>
                                <th>% of Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${getItemsByType().map(type => `
                                <tr>
                                    <td>${type.type}</td>
                                    <td>${type.count}</td>
                                    <td>‚Ç±${type.value.toFixed(2)}</td>
                                    <td>${type.percentage}%</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                
                <div style="background: #f5f0ff; padding: 15px; border-radius: 5px;">
                    <h4>üìÖ Recent Items (Last 30 Days)</h4>
                    <p>New Pawns: ${recentItems.filter(item => item.status === 'Active').length}</p>
                    <p>Items Redeemed: ${systemData.data.pawnItems.filter(item => 
                        item.status === 'Redeemed' && 
                        new Date(item.redemptionDate) >= thirtyDaysAgo
                    ).length}</p>
                    <p>Items Foreclosed: ${systemData.data.pawnItems.filter(item => 
                        item.status === 'Foreclosed' && 
                        new Date(item.remateDate) >= thirtyDaysAgo
                    ).length}</p>
                </div>
            `;
            
            document.getElementById('report-results').innerHTML = reportHTML;
        }
        
        function getItemsByType() {
            const types = {};
            
            systemData.data.pawnItems.forEach(item => {
                if (!types[item.itemType]) {
                    types[item.itemType] = { count: 0, value: 0 };
                }
                types[item.itemType].count++;
                types[item.itemType].value += item.pawnAmount;
            });
            
            const totalValue = Object.values(types).reduce((sum, type) => sum + type.value, 0);
            
            return Object.entries(types).map(([type, data]) => ({
                type,
                count: data.count,
                value: data.value,
                percentage: totalValue > 0 ? ((data.value / totalValue) * 100).toFixed(1) : '0.0'
            }));
        }
        
        function generateRemateReport() {
            const remateItems = systemData.data.pawnItems.filter(item => item.isRemate);
            const foreclosedItems = remateItems.filter(item => item.status === 'Foreclosed');
            const auctionedItems = remateItems.filter(item => item.status === 'Auctioned');
            
            const reportHTML = `
                <h3>‚öñÔ∏è Remate/Foreclosure Report</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div style="background: #fce8e8; padding: 15px; border-radius: 5px;">
                        <h4>üìä Remate Statistics</h4>
                        <p>Total Remate Items: <strong>${remateItems.length}</strong></p>
                        <p>Currently Foreclosed: <strong class="negative">${foreclosedItems.length}</strong></p>
                        <p>Auctioned Items: <strong>${auctionedItems.length}</strong></p>
                        <p>Total Pawn Value: <strong>‚Ç±${remateItems.reduce((sum, item) => sum + item.pawnAmount, 0).toFixed(2)}</strong></p>
                    </div>
                    
                    <div style="background: #f0f8f0; padding: 15px; border-radius: 5px;">
                        <h4>üíµ Financial Summary</h4>
                        <p>Remate Sales Revenue: <strong class="positive">‚Ç±${auctionedItems.reduce((sum, item) => sum + (item.salePrice || 0), 0).toFixed(2)}</strong></p>
                        <p>Total Profit: <strong class="positive">‚Ç±${auctionedItems.reduce((sum, item) => sum + (item.saleProfit || 0), 0).toFixed(2)}</strong></p>
                        <p>Inventory Value: <strong>‚Ç±${foreclosedItems.reduce((sum, item) => sum + item.pawnAmount, 0).toFixed(2)}</strong></p>
                        <p>Average Profit Margin: <strong>${auctionedItems.length > 0 ? ((auctionedItems.reduce((sum, item) => sum + ((item.saleProfit || 0) / item.pawnAmount * 100), 0) / auctionedItems.length).toFixed(1) + '%') : '0%'}</strong></p>
                    </div>
                </div>
                
                <div style="background: #fff8e8; padding: 15px; border-radius: 5px; margin: 20px 0;">
                    <h4>‚ö†Ô∏è Expired Items (Need Action)</h4>
                    <table style="width: 100%;">
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Item</th>
                                <th>Amount</th>
                                <th>Expired On</th>
                                <th>Days Overdue</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${systemData.data.pawnItems
                                .filter(item => item.status === 'Expired')
                                .slice(0, 10)
                                .map(item => {
                                    const daysOverdue = calculateDaysOverdue(item.expiryDate);
                                    return `
                                        <tr>
                                            <td>${item.itemCode}</td>
                                            <td>${item.itemName}</td>
                                            <td>‚Ç±${item.pawnAmount.toFixed(2)}</td>
                                            <td>${item.expiryDate}</td>
                                            <td class="negative">${daysOverdue} days</td>
                                        </tr>
                                    `;
                                }).join('') || '<tr><td colspan="5" style="text-align: center;">No expired items</td></tr>'}
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('report-results').innerHTML = reportHTML;
        }
        
        function generateDateRangeReport() {
            generateFinancialReport();
        }
        
        // ==================== DATA MANAGEMENT FUNCTIONS ====================
        function updateDataStats() {
            console.log('Updating data stats...');
            
            // Ensure all arrays exist
            if (!systemData.data.pawnItems) systemData.data.pawnItems = [];
            if (!systemData.data.customers) systemData.data.customers = [];
            if (!systemData.data.transactions) systemData.data.transactions = [];
            if (!systemData.data.inventory) systemData.data.inventory = [];
            
            const stats = [
                { 
                    type: 'Pawn Items', 
                    records: systemData.data.pawnItems.length,
                    key: 'pawn-items'
                },
                { 
                    type: 'Customers', 
                    records: systemData.data.customers.length,
                    key: 'customers'
                },
                { 
                    type: 'Transactions', 
                    records: systemData.data.transactions.length,
                    key: 'transactions'
                },
                { 
                    type: 'Inventory Items', 
                    records: systemData.data.inventory.length,
                    key: 'inventory-items'
                }
            ];
            
            const tbody = document.getElementById('data-stats-table');
            if (!tbody) {
                console.error('data-stats-table element not found!');
                return;
            }
            
            tbody.innerHTML = '';
            
            stats.forEach(stat => {
                // Calculate file size
                let dataToMeasure = [];
                switch(stat.key) {
                    case 'pawn-items': dataToMeasure = systemData.data.pawnItems; break;
                    case 'customers': dataToMeasure = systemData.data.customers; break;
                    case 'transactions': dataToMeasure = systemData.data.transactions; break;
                    case 'inventory-items': dataToMeasure = systemData.data.inventory; break;
                }
                
                const size = JSON.stringify(dataToMeasure).length;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${stat.type}</td>
                    <td>${stat.records}</td>
                    <td>${systemData.lastBackup ? new Date(systemData.lastBackup).toLocaleDateString() : 'Never'}</td>
                    <td>${formatFileSize(size)}</td>
                    <td>
                        <button class="btn btn-info small-btn" onclick="exportSingle('${stat.key}')">
                            Export
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Update status message
            const statusEl = document.getElementById('data-status');
            if (statusEl) {
                const totalRecords = stats.reduce((sum, stat) => sum + stat.records, 0);
                const backupTime = systemData.lastBackup ? new Date(systemData.lastBackup).toLocaleString() : 'Never';
                statusEl.textContent = `Total: ${totalRecords} records | Last backup: ${backupTime}`;
                statusEl.className = 'alert alert-success';
            }
        }
        
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' bytes';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }
        
        function exportSingle(dataType) {
            let data, filename;
            
            switch(dataType) {
                case 'pawn-items':
                    data = systemData.data.pawnItems;
                    filename = 'pawn_items';
                    break;
                case 'customers':
                    data = systemData.data.customers;
                    filename = 'customers';
                    break;
                case 'transactions':
                    data = systemData.data.transactions;
                    filename = 'transactions';
                    break;
                case 'inventory-items':
                    data = systemData.data.inventory;
                    filename = 'inventory';
                    break;
                default:
                    console.error('Unknown data type:', dataType);
                    return;
            }
            
            const exportData = {
                exportDate: new Date().toISOString(),
                exportType: dataType,
                data: data
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `pawnshop_${filename}_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            URL.revokeObjectURL(url);
            
            alert(`Exported ${data.length} ${filename.replace('_', ' ')} to ${link.download}`);
        }
        
        function backupData() {
            systemData.lastBackup = new Date().toISOString();
            saveSystemData(systemData);
            
            // Create downloadable backup
            const backup = {
                ...systemData,
                exportDate: new Date().toISOString(),
                exportType: 'full_backup'
            };
            
            const dataStr = JSON.stringify(backup, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `pawnshop_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            URL.revokeObjectURL(url);
            
            const totalRecords = systemData.data.pawnItems.length + 
                               systemData.data.customers.length + 
                               systemData.data.transactions.length + 
                               systemData.data.inventory.length;
            
            alert(`Backup completed! File: ${link.download}\nTotal records: ${totalRecords}`);
            updateDataStats();
        }
        
        function exportToJSON() {
            const exportData = {
                exportDate: new Date().toISOString(),
                exportType: 'complete_export',
                data: systemData.data
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `pawnshop_export_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            URL.revokeObjectURL(url);
            
            alert(`Exported complete data to ${link.download}`);
        }
        
        function exportToCSV() {
            // Export pawn items to CSV
            const headers = ['Code', 'Item Name', 'Type', 'Customer', 'Amount', 'Status', 'Date', 'Expiry Date'];
            const rows = systemData.data.pawnItems.map(item => [
                item.itemCode,
                `"${item.itemName.replace(/"/g, '""')}"`,
                item.itemType,
                `"${item.customerName.replace(/"/g, '""')}"`,
                item.pawnAmount,
                item.status,
                item.pawnDate,
                item.expiryDate || ''
            ]);
            
            const csvContent = [
                headers.join(','),
                ...rows.map(row => row.join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `pawnshop_inventory_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            URL.revokeObjectURL(url);
            
            alert(`Exported ${systemData.data.pawnItems.length} items to CSV file`);
        }
        
        function printAllData() {
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Sampan Pawn Shop - Data Summary</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h1 { color: #2c3e50; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                    </style>
                </head>
                <body>
                    <h1>Sampan Pawn Shop - Data Summary</h1>
                    <p>Generated on: ${new Date().toLocaleString()}</p>
                    
                    <h2>üìä System Statistics</h2>
                    <table>
                        <tr><th>Data Type</th><th>Records</th></tr>
                        <tr><td>Pawn Items</td><td>${systemData.data.pawnItems.length}</td></tr>
                        <tr><td>Customers</td><td>${systemData.data.customers.length}</td></tr>
                        <tr><td>Transactions</td><td>${systemData.data.transactions.length}</td></tr>
                        <tr><td>Inventory Items</td><td>${systemData.data.inventory.length}</td></tr>
                    </table>
                    
                    <h2>üìÖ Recent Transactions (Last 7 Days)</h2>
                    ${generateRecentTransactionsTable()}
                    
                    <h2>‚ö†Ô∏è Expired Items</h2>
                    ${generateExpiredItemsTable()}
                    
                    <script>
                        window.onload = function() {
                            window.print();
                            setTimeout(function() { window.close(); }, 1000);
                        }
                    </script>
                </body>
                </html>
            `);
            printWindow.document.close();
        }
        
        function generateRecentTransactionsTable() {
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            
            const recentTransactions = systemData.data.transactions.filter(t => 
                new Date(t.date) >= sevenDaysAgo
            ).slice(0, 20);
            
            if (recentTransactions.length === 0) {
                return '<p>No recent transactions</p>';
            }
            
            let html = '<table><tr><th>Date</th><th>Type</th><th>Code</th><th>Description</th><th>Amount</th></tr>';
            
            recentTransactions.forEach(t => {
                html += `<tr>
                    <td>${t.date}</td>
                    <td>${t.type}</td>
                    <td>${t.code}</td>
                    <td>${t.description}</td>
                    <td>‚Ç±${t.amount.toFixed(2)}</td>
                </tr>`;
            });
            
            html += '</table>';
            return html;
        }
        
        function generateExpiredItemsTable() {
            const expiredItems = systemData.data.pawnItems.filter(item => 
                item.status === 'Expired'
            ).slice(0, 20);
            
            if (expiredItems.length === 0) {
                return '<p>No expired items</p>';
            }
            
            let html = '<table><tr><th>Code</th><th>Item</th><th>Customer</th><th>Amount</th><th>Expired On</th></tr>';
            
            expiredItems.forEach(item => {
                html += `<tr>
                    <td>${item.itemCode}</td>
                    <td>${item.itemName}</td>
                    <td>${item.customerName}</td>
                    <td>‚Ç±${item.pawnAmount.toFixed(2)}</td>
                    <td>${item.expiryDate}</td>
                </tr>`;
            });
            
            html += '</table>';
            return html;
        }
        
        function clearOldData() {
            if (confirm('This will remove transactions older than 1 year. Continue?')) {
                const oneYearAgo = new Date();
                oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);
                const oneYearAgoStr = oneYearAgo.toISOString().split('T')[0];
                
                const oldCount = systemData.data.transactions.length;
                systemData.data.transactions = systemData.data.transactions.filter(t => 
                    t.date >= oneYearAgoStr
                );
                const newCount = systemData.data.transactions.length;
                
                saveSystemData(systemData);
                alert(`Cleared ${oldCount - newCount} old transactions. Remaining: ${newCount}`);
                updateDataStats();
                loadTransactions();
            }
        }
        
        // ==================== UTILITY FUNCTIONS ====================
        function updateCashPosition(amount) {
            // Update the display
            loadDailyOverview();
        }
        
        function checkExpiredItems() {
            const today = new Date(currentDate);
            let updated = false;
            
            systemData.data.pawnItems.forEach(item => {
                if (item.status === 'Active' && item.expiryDate) {
                    const expiryDate = new Date(item.expiryDate);
                    if (expiryDate < today) {
                        item.status = 'Expired';
                        updated = true;
                    }
                }
            });
            
            if (updated) {
                saveSystemData(systemData);
                loadAttentionItems();
                loadInventory();
            }
        }
        
        function autoSave() {
            saveSystemData(systemData);
            // Could show a temporary notification
        }
        
        function viewItemDetails(itemId) {
            const item = systemData.data.pawnItems.find(i => i.id === itemId);
            if (!item) return;
            
            let details = `
                Item Details:
                Code: ${item.itemCode}
                Name: ${item.itemName}
                Type: ${item.itemType}
                Customer: ${item.customerName}
                Amount: ‚Ç±${item.pawnAmount.toFixed(2)}
                Status: ${item.status}
                Pawn Date: ${item.pawnDate}
                Expiry Date: ${item.expiryDate}
            `;
            
            if (item.status === 'Redeemed' && item.redemptionDate) {
                details += `\nRedemption Date: ${item.redemptionDate}`;
                if (item.redemptionAmount) {
                    details += `\nRedemption Amount: ‚Ç±${item.redemptionAmount.toFixed(2)}`;
                }
            }
            
            if (item.status === 'Foreclosed' && item.remateDate) {
                details += `\nForeclosure Date: ${item.remateDate}`;
                if (item.inventoryValue) {
                    details += `\nInventory Value: ‚Ç±${item.inventoryValue.toFixed(2)}`;
                }
            }
            
            if (item.status === 'Auctioned') {
                if (item.remateDate) details += `\nSale Date: ${item.remateDate}`;
                if (item.salePrice) details += `\nSale Price: ‚Ç±${item.salePrice.toFixed(2)}`;
                if (item.saleProfit) details += `\nProfit: ‚Ç±${item.saleProfit.toFixed(2)}`;
            }
            
            if (item.remarks) details += `\nRemarks: ${item.remarks}`;
            
            alert(details);
        }
        
        function viewTransactionDetails(transactionId) {
            const transaction = systemData.data.transactions.find(t => t.id === transactionId);
            if (!transaction) return;
            
            let details = `
                Transaction Details:
                ID: ${transaction.id}
                Date: ${transaction.date}
                Type: ${transaction.type.toUpperCase()}
                Code: ${transaction.code}
                Description: ${transaction.description}
                Amount: ‚Ç±${transaction.amount.toFixed(2)}
                Customer: ${transaction.customerName}
                Status: ${transaction.status}
            `;
            
            if (transaction.interestRate) details += `\nInterest Rate: ${transaction.interestRate}%`;
            if (transaction.paymentMethod) details += `\nPayment Method: ${transaction.paymentMethod}`;
            if (transaction.remateType) details += `\nRemate Type: ${transaction.remateType}`;
            if (transaction.profit) details += `\nProfit: ‚Ç±${transaction.profit.toFixed(2)}`;
            
            alert(details);
        }
        
        function viewCustomerDetails(customerId) {
            const customer = systemData.data.customers.find(c => c.id === customerId);
            if (!customer) return;
            
            const customerPawns = systemData.data.pawnItems.filter(item => 
                item.customerId === customerId
            );
            
            const activePawns = customerPawns.filter(item => item.status === 'Active');
            const totalPawnAmount = customerPawns.reduce((sum, item) => sum + item.pawnAmount, 0);
            
            alert(`
                Customer Details:
                ID: ${customer.id}
                Name: ${customer.name}
                Contact: ${customer.contact}
                ${customer.email ? `Email: ${customer.email}` : ''}
                Address: ${customer.address}
                ID Type: ${customer.idType}
                ID Number: ${customer.idNumber}
                Member Since: ${customer.createdAt}
                Last Visit: ${customer.lastVisit}
                
                Statistics:
                Total Transactions: ${customer.totalTransactions || 0}
                Total Amount: ‚Ç±${customer.totalAmount?.toFixed(2) || '0.00'}
                Active Pawns: ${activePawns.length}
                Total Pawn History: ${customerPawns.length} items
                Total Pawn Amount: ‚Ç±${totalPawnAmount.toFixed(2)}
            `);
        }
        
        function editCustomer(customerId) {
            alert('Edit customer functionality would open here');
            // Implementation would open a modal for editing customer details
        }
        
        // ==================== GITHUB INTEGRATION HELPER ====================
        function setupGitHubInstructions() {
            // This function would provide instructions for GitHub integration
            console.log(`
                GitHub Integration Instructions:
                
                1. Create a GitHub repository for your pawn shop data
                2. Use the Export functions to download your data
                3. Upload the JSON files to your repository
                4. Create a README.md file with instructions
                5. Commit changes regularly
                
                Best Practices:
                - Export data daily
                - Keep backup files in the repository
                - Use meaningful commit messages
                - Include date in filenames
            `);
        }
        
        // Debug function
        function debugSystem() {
            console.log('=== SYSTEM DEBUG INFO ===');
            console.log('Current Date:', currentDate);
            console.log('System Data:', systemData);
            console.log('Pawn Items:', systemData.data.pawnItems);
            console.log('Customers:', systemData.data.customers);
            console.log('Transactions:', systemData.data.transactions);
            console.log('Inventory:', systemData.data.inventory);
            console.log('=========================');
        }
    </script>
</body>
</html>
