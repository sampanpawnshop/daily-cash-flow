<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sampan Pawn Shop - Complete Management System with Remate Tracking</title>
    <style>
        /* KEEP ALL YOUR CSS STYLES HERE - THEY ARE CORRECT */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: white;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        .shop-name {
            color: #f39c12;
            font-weight: bold;
            font-size: 1.4em;
            margin-bottom: 15px;
        }
        
        .subtitle {
            color: #ecf0f1;
            font-size: 1.1em;
            margin-top: 10px;
        }
        
        .date-section {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
        }
        
        .date-box {
            background: white;
            padding: 12px 20px;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-weight: 600;
            color: #2c3e50;
        }
        
        .dashboard-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .card-title {
            font-size: 1.2rem;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .main-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            height: fit-content;
        }
        
        .section-title {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .cash-section {
            border-top: 4px solid #3498db;
        }
        
        .items-section {
            border-top: 4px solid #9b59b6;
        }
        
        .prenda-section {
            border-top: 4px solid #e74c3c;
        }
        
        .gold-section {
            border-top: 4px solid #f1c40f;
        }
        
        .sold-section {
            border-top: 4px solid #2ecc71;
        }
        
        .remate-section {
            border-top: 4px solid #e67e22;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #444;
            font-size: 0.9em;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.95rem;
            transition: border 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th {
            background-color: #f8f9fa;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #ddd;
            position: sticky;
            top: 0;
        }
        
        td {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-success {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-warning {
            background-color: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #d68910;
        }
        
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-info {
            background-color: #17a2b8;
            color: white;
        }
        
        .btn-info:hover {
            background-color: #138496;
        }
        
        /* NEW STATUS STYLES */
        .status-active {
            background: #2ecc71;
            color: white;
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 0.85em;
            display: inline-block;
        }
        
        .status-expired {
            background: #f39c12;
            color: white;
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 0.85em;
            display: inline-block;
        }
        
        .status-renewed {
            background: #9b59b6;
            color: white;
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 0.85em;
            display: inline-block;
        }
        
        .status-redeemed {
            background: #3498db;
            color: white;
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 0.85em;
            display: inline-block;
        }
        
        .status-foreclosed {
            background: #e74c3c;
            color: white;
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 0.85em;
            display: inline-block;
        }
        
        .status-auctioned {
            background: #e67e22;
            color: white;
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 0.85em;
            display: inline-block;
        }
        
        .status-sold {
            background: #95a5a6;
            color: white;
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 0.85em;
            display: inline-block;
        }
        
        .positive {
            color: #2ecc71;
            font-weight: bold;
        }
        
        .negative {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .transaction-row {
            display: grid;
            grid-template-columns: 2fr 1fr 40px;
            gap: 10px;
            margin-bottom: 12px;
            align-items: end;
        }
        
        .delete-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .delete-btn:hover {
            background-color: #c0392b;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .summary-label {
            font-weight: 600;
            color: #555;
        }
        
        .summary-value {
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .cash-in {
            color: #2ecc71;
        }
        
        .cash-out {
            color: #e74c3c;
        }
        
        .actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab-button {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #7f8c8d;
            border-bottom: 3px solid transparent;
        }
        
        .tab-button.active {
            color: #3498db;
            border-bottom: 3px solid #3498db;
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            color: #7f8c8d;
            font-size: 0.9rem;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }
        
        .small-btn {
            padding: 4px 8px;
            font-size: 0.8em;
            margin: 2px;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                padding: 10px;
                background: white;
            }
            
            .section {
                box-shadow: none;
                border: 1px solid #ddd;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Pawn Shop Management System</h1>
            <div class="shop-name">Sampan Pawn Shop</div>
            <div class="subtitle">Complete Daily Operations Tracking with Remate System</div>
            
            <div class="date-section">
                <div class="date-box">
                    <label for="date">Date:</label>
                    <input type="date" id="date" value="">
                </div>
                <div class="date-box">
                    <label for="prepared-by">Prepared By:</label>
                    <input type="text" id="prepared-by" placeholder="Staff Name">
                </div>
            </div>
        </header>
        
        <!-- Dashboard -->
        <div class="dashboard-container">
            <div class="dashboard-card">
                <div class="card-title">üìä Quick Stats</div>
                <div class="summary-item">
                    <span>Active Pawns:</span>
                    <strong id="active-pawns">0</strong>
                </div>
                <div class="summary-item">
                    <span>Expired Items:</span>
                    <strong class="negative" id="expired-pawns">0</strong>
                </div>
                <div class="summary-item">
                    <span>Today's Lukat:</span>
                    <strong class="positive" id="today-lukat">‚Ç±0.00</strong>
                </div>
                <div class="summary-item">
                    <span>Today's Remate:</span>
                    <strong class="negative" id="today-remate">‚Ç±0.00</strong>
                </div>
            </div>
            
            <div class="dashboard-card">
                <div class="card-title">üí∞ Cash Position</div>
                <div class="summary-item">
                    <span>Opening Balance:</span>
                    <strong>‚Ç±<input type="number" id="opening-balance" value="5000" style="width: 120px; border: none; text-align: right; font-weight: bold;"></strong>
                </div>
                <div class="summary-item">
                    <span>Cash In Today:</span>
                    <strong class="cash-in" id="dash-cash-in">‚Ç±0.00</strong>
                </div>
                <div class="summary-item">
                    <span>Cash Out Today:</span>
                    <strong class="cash-out" id="dash-cash-out">‚Ç±0.00</strong>
                </div>
                <div class="summary-item" style="border-top: 2px solid #ddd; padding-top: 10px;">
                    <span>Closing Balance:</span>
                    <strong id="dash-closing-bal">‚Ç±5,000.00</strong>
                </div>
            </div>
            
            <div class="dashboard-card">
                <div class="card-title">‚ö° Quick Actions</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <button class="btn btn-primary" onclick="showSection('cash-flow')">üí∏ Cash Flow</button>
                    <button class="btn btn-warning" onclick="showSection('prenda')">üìù New Pawn</button>
                    <button class="btn btn-success" onclick="showSection('lukat')">üíµ Process Lukat</button>
                    <button class="btn btn-danger" onclick="showSection('remate')">‚öñÔ∏è Process Remate</button>
                </div>
            </div>
        </div>
        
        <!-- Main Content Sections -->
        <div class="main-container">
            <!-- Left Column -->
            <div>
                <!-- Cash Flow Section -->
                <div class="section cash-section" id="cash-flow-section">
                    <div class="section-title">
                        <span>üí∏ Daily Cash Flow</span>
                    </div>
                    
                    <div class="form-group">
                        <label>Cash Inflows (Pumasok na Pera)</label>
                        <div id="cash-in-container">
                            <div class="transaction-row">
                                <div>
                                    <input type="text" class="cash-in-desc" value="Sales" placeholder="Description">
                                </div>
                                <div>
                                    <input type="number" class="cash-in-amount" placeholder="Amount" value="0">
                                </div>
                                <button class="delete-btn" onclick="deleteRow(this)">√ó</button>
                            </div>
                            <div class="transaction-row">
                                <div>
                                    <input type="text" class="cash-in-desc" value="Renew" placeholder="Description">
                                </div>
                                <div>
                                    <input type="number" class="cash-in-amount" placeholder="Amount" value="0">
                                </div>
                                <button class="delete-btn" onclick="deleteRow(this)">√ó</button>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="addCashInRow()">+ Add Cash In</button>
                    </div>
                    
                    <div class="form-group">
                        <label>Cash Outflows (Labas na Pera)</label>
                        <div id="cash-out-container">
                            <div class="transaction-row">
                                <div>
                                    <input type="text" class="cash-out-desc" value="Expenses" placeholder="Description">
                                </div>
                                <div>
                                    <input type="number" class="cash-out-amount" placeholder="Amount" value="0">
                                </div>
                                <button class="delete-btn" onclick="deleteRow(this)">√ó</button>
                            </div>
                            <div class="transaction-row">
                                <div>
                                    <input type="text" class="cash-out-desc" value="Prenda" placeholder="Description">
                                </div>
                                <div>
                                    <input type="number" class="cash-out-amount" placeholder="Amount" value="0">
                                </div>
                                <button class="delete-btn" onclick="deleteRow(this)">√ó</button>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="addCashOutRow()">+ Add Cash Out</button>
                    </div>
                    
                    <div class="summary-item">
                        <span>Total Cash In:</span>
                        <strong class="cash-in" id="total-cash-in">‚Ç±0.00</strong>
                    </div>
                    <div class="summary-item">
                        <span>Total Cash Out:</span>
                        <strong class="cash-out" id="total-cash-out">‚Ç±0.00</strong>
                    </div>
                    <div class="summary-item">
                        <span>Net Cash Flow:</span>
                        <strong id="net-cash-flow">‚Ç±0.00</strong>
                    </div>
                </div>
                
                <!-- New Pawn Item Section -->
                <div class="section prenda-section" id="prenda-section">
                    <div class="section-title">
                        <span>üìù New Pawn Item (Prenda)</span>
                    </div>
                    
                    <div class="form-group">
                        <label>Item Code</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="item-code-prefix" value="P-" style="width: 80px;" readonly>
                            <input type="text" id="item-code-suffix" value="001" style="width: 80px;">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Item Name/Description</label>
                        <input type="text" id="item-name" placeholder="e.g., Gold Ring, Laptop, etc.">
                    </div>
                    
                    <div class="form-group">
                        <label>Item Type</label>
                        <select id="item-type">
                            <option value="Jewelry">Jewelry</option>
                            <option value="Electronics">Electronics</option>
                            <option value="Appliances">Appliances</option>
                            <option value="Tools">Tools</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>Weight (grams)</label>
                            <input type="number" id="item-weight" placeholder="0.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Karat (for gold)</label>
                            <input type="number" id="item-karat" placeholder="e.g., 18, 24">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>Pawn Amount (‚Ç±)</label>
                            <input type="number" id="pawn-amount" placeholder="0.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Term (Days)</label>
                            <select id="pawn-term">
                                <option value="30">30 days</option>
                                <option value="60">60 days</option>
                                <option value="90">90 days</option>
                                <option value="120">120 days</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>Customer Name</label>
                            <input type="text" id="customer-name" placeholder="Customer Name">
                        </div>
                        <div class="form-group">
                            <label>Contact Number</label>
                            <input type="text" id="customer-contact" placeholder="09XXXXXXXXX">
                        </div>
                    </div>
                    
                    <button class="btn btn-warning" style="width: 100%; padding: 12px;" onclick="addPawnItem()">
                        ‚úÖ Add Pawn Item
                    </button>
                </div>
                
                <!-- Lukat (Redemption) Section -->
                <div class="section items-section" id="lukat-section">
                    <div class="section-title">
                        <span>üíµ Process Lukat (Redemption)</span>
                    </div>
                    
                    <div class="form-group">
                        <label>Pawn Item Code</label>
                        <input type="text" id="lukat-item-code" placeholder="Enter pawn item code">
                    </div>
                    
                    <div class="form-group">
                        <label>Customer Name</label>
                        <input type="text" id="lukat-customer-name" placeholder="Customer Name">
                    </div>
                    
                    <div class="form-group">
                        <label>Original Pawn Amount (‚Ç±)</label>
                        <input type="number" id="lukat-original-amount" placeholder="0.00" step="0.01" readonly>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>Interest Rate (%)</label>
                            <select id="lukat-interest-rate">
                                <option value="5">5%</option>
                                <option value="7">7%</option>
                                <option value="10">10%</option>
                                <option value="15">15%</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Total to Pay (‚Ç±)</label>
                            <input type="number" id="lukat-total-amount" placeholder="0.00" step="0.01" readonly>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Remarks</label>
                        <textarea id="lukat-remarks" placeholder="Additional notes..." rows="2"></textarea>
                    </div>
                    
                    <button class="btn btn-success" style="width: 100%; padding: 12px;" onclick="processLukat()">
                        üíµ Process Lukat (Redemption)
                    </button>
                </div>
            </div>
            
            <!-- Right Column -->
            <div>
                <!-- Pawn Items Management Tabs -->
                <div class="section prenda-section">
                    <div class="section-title">
                        <span>üìã Pawn Items Management</span>
                        <div class="tab-buttons">
                            <button class="tab-button active" onclick="showPawnTab('active')">Active</button>
                            <button class="tab-button" onclick="showPawnTab('expired')">Expired</button>
                            <button class="tab-button" onclick="showPawnTab('redeemed')">Redeemed</button>
                            <button class="tab-button" onclick="showPawnTab('foreclosed')">Foreclosed</button>
                            <button class="tab-button" onclick="showPawnTab('all')">All</button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>Item</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Due Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pawn-items-body">
                                <!-- Pawn items will be loaded here -->
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 20px; color: #7f8c8d;">
                                        No pawn items yet
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Remate (Foreclosure) Section -->
                <div class="section remate-section" id="remate-section">
                    <div class="section-title">
                        <span>‚öñÔ∏è Process Remate (Foreclosure)</span>
                    </div>
                    
                    <div class="form-group">
                        <label>Pawn Item Code</label>
                        <input type="text" id="remate-item-code" placeholder="Enter expired pawn item code">
                    </div>
                    
                    <div class="form-group">
                        <label>Item Name</label>
                        <input type="text" id="remate-item-name" placeholder="Item description">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>Original Pawn Amount (‚Ç±)</label>
                            <input type="number" id="remate-original-amount" placeholder="0.00" step="0.01" readonly>
                        </div>
                        <div class="form-group">
                            <label>Days Overdue</label>
                            <input type="number" id="remate-days-overdue" placeholder="0" readonly>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Remate Type</label>
                        <select id="remate-type">
                            <option value="auction">Auction Sale</option>
                            <option value="direct">Direct Sale</option>
                            <option value="inventory">Add to Inventory</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Sale Price (‚Ç±)</label>
                        <input type="number" id="remate-sale-price" placeholder="0.00" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label>Remate Remarks</label>
                        <textarea id="remate-remarks" placeholder="Remate details..." rows="2"></textarea>
                    </div>
                    
                    <button class="btn btn-danger" style="width: 100%; padding: 12px;" onclick="processRemate()">
                        ‚öñÔ∏è Process Remate (Foreclosure)
                    </button>
                </div>
                
                <!-- Sold Items Section -->
                <div class="section sold-section" id="sold-section">
                    <div class="section-title">
                        <span>üí∞ Record Sold Item</span>
                    </div>
                    
                    <div class="form-group">
                        <label>Sale Code</label>
                        <input type="text" id="sold-item-code" value="S-" placeholder="S-001">
                    </div>
                    
                    <div class="form-group">
                        <label>Item Name</label>
                        <input type="text" id="sold-item-name" placeholder="Item description">
                    </div>
                    
                    <div class="form-group">
                        <label>Item Type</label>
                        <select id="sold-item-type">
                            <option value="Jewelry">Jewelry</option>
                            <option value="Electronics">Electronics</option>
                            <option value="Appliances">Appliances</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>Weight (grams)</label>
                            <input type="number" id="sold-weight" placeholder="0.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Karat</label>
                            <input type="number" id="sold-karat" placeholder="e.g., 18, 24">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Sale Price (‚Ç±)</label>
                        <input type="number" id="sale-price" placeholder="0.00" step="0.01">
                    </div>
                    
                    <button class="btn btn-danger" style="width: 100%; padding: 12px;" onclick="addNewSoldItem()">
                        üí∞ Record Sale
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Reports Section -->
        <div class="dashboard-card" style="margin-top: 30px;">
            <div class="card-title">üìä Daily Report with Remate Tracking</div>
            <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="generateDailyReport()">
                    üìã Generate Daily Report
                </button>
                <button class="btn btn-success" onclick="generateRemateReport()">
                    ‚öñÔ∏è Generate Remate Report
                </button>
                <button class="btn btn-warning" onclick="checkExpirations()">
                    ‚ö†Ô∏è Check Expirations
                </button>
                <button class="btn btn-danger" onclick="printReport()">
                    üñ®Ô∏è Print Report
                </button>
                <button class="btn btn-danger" onclick="clearTodayData()">
                    üóëÔ∏è Clear Today's Data
                </button>
            </div>
            <div id="report-results" style="min-height: 100px; padding: 20px; background: #f8f9fa; border-radius: 5px;">
                <div style="text-align: center; color: #7f8c8d;">
                    Click "Generate Daily Report" to view today's summary
                </div>
            </div>
        </div>
        
        <footer>
            <p>Sampan Pawn Shop Management System &copy; <span id="current-year"></span></p>
            <p style="margin-top: 10px; font-size: 0.9em; color: #95a5a6;">
                All data is stored locally in your browser. Export data regularly for backup.
            </p>
        </footer>
    </div>
    
    <!-- JavaScript -->
    <script>
        // ==================== DATA STORAGE ====================
        let pawnItems = JSON.parse(localStorage.getItem('pawnItems')) || [];
        let renewTransactions = JSON.parse(localStorage.getItem('renewTransactions')) || [];
        let soldItems = JSON.parse(localStorage.getItem('soldItems')) || [];
        let goldPurchases = JSON.parse(localStorage.getItem('goldPurchases')) || [];
        let silverPurchases = JSON.parse(localStorage.getItem('silverPurchases')) || [];
        let cashInTransactions = JSON.parse(localStorage.getItem('cashInTransactions')) || [];
        let cashOutTransactions = JSON.parse(localStorage.getItem('cashOutTransactions')) || [];
        let lukatTransactions = JSON.parse(localStorage.getItem('lukatTransactions')) || [];
        let remateTransactions = JSON.parse(localStorage.getItem('remateTransactions')) || [];

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            
            // Set current year
            document.getElementById('current-year').textContent = new Date().getFullYear();
            
            // Load all data
            loadPawnItems('active');
            loadDashboard();
            calculateTotals();
            
            // Setup event listeners
            setupEventListeners();
            
            // Check for expired items
            setTimeout(checkExpirations, 1000);
            
            // Auto-calculate totals
            setInterval(calculateTotals, 1000);
        });

        // ==================== PAWN ITEMS MANAGEMENT ====================
        function addPawnItem() {
            const itemCode = document.getElementById('item-code-prefix').value + 
                            document.getElementById('item-code-suffix').value;
            const itemName = document.getElementById('item-name').value;
            const itemType = document.getElementById('item-type').value;
            const weight = document.getElementById('item-weight').value;
            const karat = document.getElementById('item-karat').value;
            const pawnAmount = document.getElementById('pawn-amount').value;
            const termDays = document.getElementById('pawn-term').value;
            const customerName = document.getElementById('customer-name').value;
            const contact = document.getElementById('customer-contact').value;
            
            if (!itemName || !pawnAmount) {
                alert('Please fill in Item Name and Pawn Amount');
                return;
            }
            
            // Calculate expiry date
            const pawnDate = new Date();
            const expiryDate = new Date(pawnDate);
            expiryDate.setDate(expiryDate.getDate() + parseInt(termDays));
            
            const newItem = {
                id: Date.now(),
                itemCode: itemCode,
                itemName: itemName,
                itemType: itemType,
                weight: parseFloat(weight) || 0,
                karat: parseInt(karat) || 0,
                pawnAmount: parseFloat(pawnAmount),
                termDays: parseInt(termDays),
                customerName: customerName,
                contact: contact,
                pawnDate: pawnDate.toISOString().split('T')[0],
                expiryDate: expiryDate.toISOString().split('T')[0],
                status: 'Active',
                isRemate: false,
                remateDate: null,
                redemptionDate: null,
                redemptionAmount: null,
                renewalCount: 0,
                lastRenewalDate: null
            };
            
            pawnItems.push(newItem);
            localStorage.setItem('pawnItems', JSON.stringify(pawnItems));
            loadPawnItems('active');
            loadDashboard();
            
            // Add to cash out
            addToCashOut('Prenda - ' + itemCode, pawnAmount);
            
            // Clear form
            document.getElementById('item-name').value = '';
            document.getElementById('item-weight').value = '';
            document.getElementById('item-karat').value = '';
            document.getElementById('pawn-amount').value = '';
            document.getElementById('customer-name').value = '';
            document.getElementById('customer-contact').value = '';
            
            // Increment item code
            const currentSuffix = parseInt(document.getElementById('item-code-suffix').value) || 1;
            document.getElementById('item-code-suffix').value = (currentSuffix + 1).toString().padStart(3, '0');
            
            alert('Pawn item added successfully! Expiry: ' + expiryDate.toISOString().split('T')[0]);
        }

        function loadPawnItems(filter = 'active') {
            const tbody = document.getElementById('pawn-items-body');
            
            let filteredItems = [];
            
            switch(filter) {
                case 'active':
                    filteredItems = pawnItems.filter(item => item.status === 'Active');
                    break;
                case 'expired':
                    filteredItems = pawnItems.filter(item => item.status === 'Expired');
                    break;
                case 'redeemed':
                    filteredItems = pawnItems.filter(item => item.status === 'Redeemed');
                    break;
                case 'foreclosed':
                    filteredItems = pawnItems.filter(item => item.status === 'Foreclosed');
                    break;
                case 'all':
                    filteredItems = pawnItems;
                    break;
                default:
                    filteredItems = pawnItems.filter(item => item.status === 'Active');
            }
            
            tbody.innerHTML = '';
            
            if (filteredItems.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px; color: #7f8c8d;">
                            No pawn items found
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredItems.forEach(item => {
                const row = document.createElement('tr');
                
                // Calculate days until expiry
                const today = new Date();
                const expiryDate = new Date(item.expiryDate);
                const daysDiff = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
                
                // Status badge
                let statusBadge = '';
                if (item.status === 'Active') {
                    statusBadge = daysDiff <= 3 ? 'status-expired' : 'status-active';
                } else if (item.status === 'Expired') {
                    statusBadge = 'status-expired';
                } else if (item.status === 'Redeemed') {
                    statusBadge = 'status-redeemed';
                } else if (item.status === 'Foreclosed') {
                    statusBadge = 'status-foreclosed';
                } else if (item.status === 'Renewed') {
                    statusBadge = 'status-renewed';
                } else if (item.status === 'Auctioned') {
                    statusBadge = 'status-auctioned';
                } else if (item.status === 'Sold') {
                    statusBadge = 'status-sold';
                }
                
                // Action buttons based on status
                let actionButtons = '';
                if (item.status === 'Active') {
                    if (daysDiff <= 3) {
                        actionButtons = `
                            <button class="btn btn-warning small-btn" onclick="renewItem('${item.id}')">Renew</button>
                            <button class="btn btn-danger small-btn" onclick="processRemateFromList('${item.id}')">Remate</button>
                            <button class="btn btn-success small-btn" onclick="processLukatFromList('${item.id}')">Lukat</button>
                        `;
                    } else {
                        actionButtons = `
                            <button class="btn btn-success small-btn" onclick="processLukatFromList('${item.id}')">Lukat</button>
                            <button class="btn btn-warning small-btn" onclick="renewItem('${item.id}')">Renew</button>
                        `;
                    }
                } else if (item.status === 'Expired') {
                    actionButtons = `
                        <button class="btn btn-warning small-btn" onclick="renewItem('${item.id}')">Renew</button>
                        <button class="btn btn-danger small-btn" onclick="processRemateFromList('${item.id}')">Remate</button>
                    `;
                } else if (item.status === 'Foreclosed') {
                    actionButtons = `
                        <button class="btn btn-info small-btn" onclick="sellForeclosedItem('${item.id}')">Sell</button>
                    `;
                }
                
                row.innerHTML = `
                    <td><strong>${item.itemCode}</strong></td>
                    <td>${item.itemName} ${item.weight ? '(' + item.weight + 'g)' : ''}</td>
                    <td>‚Ç±${item.pawnAmount.toFixed(2)}</td>
                    <td><span class="${statusBadge}">${item.status}</span></td>
                    <td>${item.expiryDate} ${item.status === 'Active' ? `(${daysDiff} days)` : ''}</td>
                    <td>${actionButtons}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function showPawnTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Load items for selected tab
            loadPawnItems(tabName);
        }

        // ==================== LUKAT (REDEMPTION) FUNCTIONS ====================
        function processLukat() {
            const itemCode = document.getElementById('lukat-item-code').value;
            const customerName = document.getElementById('lukat-customer-name').value;
            const interestRate = parseFloat(document.getElementById('lukat-interest-rate').value);
            const remarks = document.getElementById('lukat-remarks').value;
            
            // Find the item
            const item = pawnItems.find(p => p.itemCode === itemCode && p.status === 'Active');
            if (!item) {
                alert('Item not found or not active!');
                return;
            }
            
            if (item.customerName !== customerName) {
                if (!confirm('Customer name does not match. Continue anyway?')) {
                    return;
                }
            }
            
            // Calculate total amount
            const interestAmount = item.pawnAmount * (interestRate / 100);
            const totalAmount = item.pawnAmount + interestAmount;
            
            const lukatCode = 'L-' + Date.now().toString().slice(-6);
            const newLukat = {
                id: Date.now(),
                lukatCode: lukatCode,
                itemCode: item.itemCode,
                itemName: item.itemName,
                customerName: customerName,
                pawnAmount: item.pawnAmount,
                interestRate: interestRate,
                interestAmount: interestAmount,
                totalAmount: totalAmount,
                remarks: remarks,
                lukatDate: new Date().toISOString().split('T')[0]
            };
            
            // Update item status
            item.status = 'Redeemed';
            item.redemptionDate = new Date().toISOString().split('T')[0];
            item.redemptionAmount = totalAmount;
            
            // Save data
            lukatTransactions.push(newLukat);
            localStorage.setItem('lukatTransactions', JSON.stringify(lukatTransactions));
            localStorage.setItem('pawnItems', JSON.stringify(pawnItems));
            
            // Add to cash in
            addToCashIn('Lukat - ' + item.itemCode, totalAmount);
            
            // Clear form
            document.getElementById('lukat-item-code').value = '';
            document.getElementById('lukat-customer-name').value = '';
            document.getElementById('lukat-remarks').value = '';
            
            alert(`Lukat processed successfully!\nCode: ${lukatCode}\nTotal: ‚Ç±${totalAmount.toFixed(2)}`);
            loadPawnItems('active');
            loadDashboard();
        }

        function processLukatFromList(itemId) {
            const item = pawnItems.find(p => p.id == itemId);
            if (!item) return;
            
            // Fill the lukat form
            document.getElementById('lukat-item-code').value = item.itemCode;
            document.getElementById('lukat-customer-name').value = item.customerName;
            document.getElementById('lukat-original-amount').value = item.pawnAmount;
            
            // Calculate total
            const interestRate = parseFloat(document.getElementById('lukat-interest-rate').value);
            const interestAmount = item.pawnAmount * (interestRate / 100);
            const totalAmount = item.pawnAmount + interestAmount;
            document.getElementById('lukat-total-amount').value = totalAmount.toFixed(2);
            
            // Scroll to lukat section
            showSection('lukat');
        }

        // ==================== REMATE (FORECLOSURE) FUNCTIONS ====================
        function processRemate() {
            const itemCode = document.getElementById('remate-item-code').value;
            const itemName = document.getElementById('remate-item-name').value;
            const remateType = document.getElementById('remate-type').value;
            const salePrice = parseFloat(document.getElementById('remate-sale-price').value) || 0;
            const remarks = document.getElementById('remate-remarks').value;
            
            // Find the item (should be expired)
            const item = pawnItems.find(p => p.itemCode === itemCode && (p.status === 'Expired' || p.status === 'Active'));
            if (!item) {
                alert('Item not found or not expired!');
                return;
            }
            
            // Calculate days overdue
            const today = new Date();
            const expiryDate = new Date(item.expiryDate);
            const daysOverdue = Math.max(0, Math.ceil((today - expiryDate) / (1000 * 60 * 60 * 24)));
            
            const remateCode = 'RM-' + Date.now().toString().slice(-6);
            const newRemate = {
                id: Date.now(),
                remateCode: remateCode,
                itemCode: item.itemCode,
                itemName: item.itemName,
                customerName: item.customerName,
                pawnAmount: item.pawnAmount,
                remateType: remateType,
                salePrice: salePrice,
                profit: salePrice - item.pawnAmount,
                daysOverdue: daysOverdue,
                remarks: remarks,
                remateDate: new Date().toISOString().split('T')[0]
            };
            
            // Update item status
            if (remateType === 'inventory') {
                item.status = 'Foreclosed';
                item.isRemate = true;
                item.remateDate = new Date().toISOString().split('T')[0];
            } else if (remateType === 'auction' || remateType === 'direct') {
                item.status = 'Auctioned';
                item.isRemate = true;
                item.remateDate = new Date().toISOString().split('T')[0];
                
                // Add to sold items
                const soldCode = 'AUCTION-' + Date.now().toString().slice(-6);
                const newSale = {
                    id: Date.now(),
                    soldCode: soldCode,
                    itemCode: item.itemCode,
                    itemName: item.itemName,
                    itemType: item.itemType,
                    salePrice: salePrice,
                    profit: salePrice - item.pawnAmount,
                    isRemate: true,
                    saleDate: new Date().toISOString().split('T')[0]
                };
                soldItems.push(newSale);
                localStorage.setItem('soldItems', JSON.stringify(soldItems));
                
                // Add to cash in
                addToCashIn('Remate Sale - ' + item.itemCode, salePrice);
            }
            
            // Save data
            remateTransactions.push(newRemate);
            localStorage.setItem('remateTransactions', JSON.stringify(remateTransactions));
            localStorage.setItem('pawnItems', JSON.stringify(pawnItems));
            
            // Clear form
            document.getElementById('remate-item-code').value = '';
            document.getElementById('remate-item-name').value = '';
            document.getElementById('remate-sale-price').value = '';
            document.getElementById('remate-remarks').value = '';
            
            alert(`Remate processed successfully!\nCode: ${remateCode}\nType: ${remateType}`);
            loadPawnItems('expired');
            loadDashboard();
        }

        function processRemateFromList(itemId) {
            const item = pawnItems.find(p => p.id == itemId);
            if (!item) return;
            
            // Calculate days overdue
            const today = new Date();
            const expiryDate = new Date(item.expiryDate);
            const daysOverdue = Math.max(0, Math.ceil((today - expiryDate) / (1000 * 60 * 60 * 24)));
            
            // Fill the remate form
            document.getElementById('remate-item-code').value = item.itemCode;
            document.getElementById('remate-item-name').value = item.itemName;
            document.getElementById('remate-original-amount').value = item.pawnAmount;
            document.getElementById('remate-days-overdue').value = daysOverdue;
            document.getElementById('remate-sale-price').value = (item.pawnAmount * 1.5).toFixed(2);
            
            // Scroll to remate section
            showSection('remate');
        }

        function sellForeclosedItem(itemId) {
            const item = pawnItems.find(p => p.id == itemId && p.status === 'Foreclosed');
            if (!item) {
                alert('Item not found or not foreclosed!');
                return;
            }
            
            const salePrice = prompt(`Enter sale price for ${item.itemCode} (${item.itemName}):`, 
                                   (item.pawnAmount * 1.5).toFixed(2));
            
            if (salePrice && !isNaN(salePrice)) {
                item.status = 'Auctioned';
                
                // Add to sold items
                const soldCode = 'SALE-' + Date.now().toString().slice(-6);
                const newSale = {
                    id: Date.now(),
                    soldCode: soldCode,
                    itemCode: item.itemCode,
                    itemName: item.itemName,
                    itemType: item.itemType,
                    salePrice: parseFloat(salePrice),
                    profit: parseFloat(salePrice) - item.pawnAmount,
                    isRemate: true,
                    saleDate: new Date().toISOString().split('T')[0]
                };
                soldItems.push(newSale);
                localStorage.setItem('soldItems', JSON.stringify(soldItems));
                
                // Add to cash in
                addToCashIn('Foreclosed Sale - ' + item.itemCode, salePrice);
                
                localStorage.setItem('pawnItems', JSON.stringify(pawnItems));
                alert('Foreclosed item sold!');
                loadPawnItems('foreclosed');
                loadDashboard();
            }
        }

        // ==================== RENEW FUNCTION ====================
        function renewItem(itemId) {
            const item = pawnItems.find(p => p.id == itemId);
            if (!item) return;
            
            // Calculate new expiry date (add term days)
            const today = new Date();
            const newExpiryDate = new Date(today);
            newExpiryDate.setDate(newExpiryDate.getDate() + item.termDays);
            
            const renewAmount = prompt(`Enter renewal amount for ${item.itemCode} (${item.itemName}):\nOriginal: ‚Ç±${item.pawnAmount.toFixed(2)}\nNew expiry: ${newExpiryDate.toISOString().split('T')[0]}`, 
                                     (item.pawnAmount * 0.05).toFixed(2));
            
            if (renewAmount && !isNaN(renewAmount)) {
                const renewCode = 'REN-' + Date.now().toString().slice(-6);
                const newRenew = {
                    id: Date.now(),
                    renewCode: renewCode,
                    itemCode: item.itemCode,
                    itemName: item.itemName,
                    renewAmount: parseFloat(renewAmount),
                    previousStatus: item.status,
                    newExpiryDate: newExpiryDate.toISOString().split('T')[0],
                    renewDate: new Date().toISOString().split('T')[0]
                };
                
                renewTransactions.push(newRenew);
                localStorage.setItem('renewTransactions', JSON.stringify(renewTransactions));
                
                // Update item
                item.status = 'Active';
                item.expiryDate = newExpiryDate.toISOString().split('T')[0];
                item.renewalCount = (item.renewalCount || 0) + 1;
                item.lastRenewalDate = new Date().toISOString().split('T')[0];
                localStorage.setItem('pawnItems', JSON.stringify(pawnItems));
                
                // Add to cash in
                addToCashIn('Renew - ' + item.itemCode, renewAmount);
                
                alert(`Renewal processed: ${renewCode}\nAmount: ‚Ç±${parseFloat(renewAmount).toFixed(2)}\nNew expiry: ${newExpiryDate.toISOString().split('T')[0]}`);
                loadPawnItems('active');
                loadDashboard();
            }
        }

        // ==================== CHECK EXPIRATIONS ====================
        function checkExpirations() {
            const today = new Date().toISOString().split('T')[0];
            let expiredCount = 0;
            let expiringSoonCount = 0;
            
            pawnItems.forEach(item => {
                if (item.status === 'Active' && item.expiryDate) {
                    const expiryDate = new Date(item.expiryDate);
                    const todayDate = new Date(today);
                    const daysDiff = Math.ceil((expiryDate - todayDate) / (1000 * 60 * 60 * 24));
                    
                    if (daysDiff < 0) {
                        item.status = 'Expired';
                        expiredCount++;
                    } else if (daysDiff <= 3) {
                        expiringSoonCount++;
                    }
                }
            });
            
            if (expiredCount > 0) {
                localStorage.setItem('pawnItems', JSON.stringify(pawnItems));
                loadPawnItems('active');
                alert(`‚ö†Ô∏è ${expiredCount} item(s) have expired and marked as "Expired"!\nCheck the Expired tab.`);
            }
            
            if (expiringSoonCount > 0) {
                console.log(`${expiringSoonCount} item(s) expiring in 3 days or less`);
            }
            
            return expiredCount;
        }

        // ==================== CASH FLOW MANAGEMENT ====================
        function addToCashIn(description, amount) {
            const container = document.getElementById('cash-in-container');
            const row = document.createElement('div');
            row.className = 'transaction-row';
            row.innerHTML = `
                <div>
                    <input type="text" class="cash-in-desc" value="${description}" readonly>
                </div>
                <div>
                    <input type="number" class="cash-in-amount" value="${amount}" min="0" step="0.01">
                </div>
                <button class="delete-btn" onclick="deleteRow(this)">√ó</button>
            `;
            container.appendChild(row);
            
            // Save to localStorage
            cashInTransactions.push({ description, amount: parseFloat(amount) });
            localStorage.setItem('cashInTransactions', JSON.stringify(cashInTransactions));
            
            calculateTotals();
        }

        function addToCashOut(description, amount) {
            const container = document.getElementById('cash-out-container');
            const row = document.createElement('div');
            row.className = 'transaction-row';
            row.innerHTML = `
                <div>
                    <input type="text" class="cash-out-desc" value="${description}" readonly>
                </div>
                <div>
                    <input type="number" class="cash-out-amount" value="${amount}" min="0" step="0.01">
                </div>
                <button class="delete-btn" onclick="deleteRow(this)">√ó</button>
            `;
            container.appendChild(row);
            
            // Save to localStorage
            cashOutTransactions.push({ description, amount: parseFloat(amount) });
            localStorage.setItem('cashOutTransactions', JSON.stringify(cashOutTransactions));
            
            calculateTotals();
        }

        function addCashInRow() {
            const container = document.getElementById('cash-in-container');
            const row = document.createElement('div');
            row.className = 'transaction-row';
            row.innerHTML = `
                <div>
                    <input type="text" class="cash-in-desc" placeholder="Description">
                </div>
                <div>
                    <input type="number" class="cash-in-amount" placeholder="Amount" value="0">
                </div>
                <button class="delete-btn" onclick="deleteRow(this)">√ó</button>
            `;
            container.appendChild(row);
        }

        function addCashOutRow() {
            const container = document.getElementById('cash-out-container');
            const row = document.createElement('div');
            row.className = 'transaction-row';
            row.innerHTML = `
                <div>
                    <input type="text" class="cash-out-desc" placeholder="Description">
                </div>
                <div>
                    <input type="number" class="cash-out-amount" placeholder="Amount" value="0">
                </div>
                <button class="delete-btn" onclick="deleteRow(this)">√ó</button>
            `;
            container.appendChild(row);
        }

        function deleteRow(button) {
            if (confirm('Delete this transaction?')) {
                button.closest('.transaction-row').remove();
                calculateTotals();
            }
        }

        function calculateTotals() {
            // Calculate cash in
            let totalCashIn = 0;
            document.querySelectorAll('.cash-in-amount').forEach(input => {
                totalCashIn += parseFloat(input.value) || 0;
            });
            
            // Calculate cash out
            let totalCashOut = 0;
            document.querySelectorAll('.cash-out-amount').forEach(input => {
                totalCashOut += parseFloat(input.value) || 0;
            });
            
            // Get opening balance
            const openingBalance = parseFloat(document.getElementById('opening-balance').value) || 0;
            
            // Calculate net cash flow and closing balance
            const netCashFlow = totalCashIn - totalCashOut;
            const closingBalance = openingBalance + netCashFlow;
            
            // Update display
            document.getElementById('total-cash-in').textContent = '‚Ç±' + totalCashIn.toFixed(2);
            document.getElementById('total-cash-out').textContent = '‚Ç±' + totalCashOut.toFixed(2);
            document.getElementById('net-cash-flow').textContent = '‚Ç±' + netCashFlow.toFixed(2);
            
            // Update dashboard
            document.getElementById('dash-cash-in').textContent = '‚Ç±' + totalCashIn.toFixed(2);
            document.getElementById('dash-cash-out').textContent = '‚Ç±' + totalCashOut.toFixed(2);
            document.getElementById('dash-closing-bal').textContent = '‚Ç±' + closingBalance.toFixed(2);
            
            // Update net cash flow color
            const netElement = document.getElementById('net-cash-flow');
            if (netCashFlow >= 0) {
                netElement.className = 'positive';
            } else {
                netElement.className = 'negative';
            }
        }

        // ==================== SOLD ITEMS MANAGEMENT ====================
        function addNewSoldItem() {
            const soldCode = document.getElementById('sold-item-code').value;
            const itemName = document.getElementById('sold-item-name').value;
            const itemType = document.getElementById('sold-item-type').value;
            const weight = document.getElementById('sold-weight').value;
            const karat = document.getElementById('sold-karat').value;
            const salePrice = document.getElementById('sale-price').value;
            
            if (!itemName || !salePrice) {
                alert('Please fill in Item Name and Sale Price');
                return;
            }
            
            const newSale = {
                id: Date.now(),
                soldCode: soldCode,
                itemCode: 'DIRECT-' + Date.now().toString().slice(-6),
                itemName: itemName,
                itemType: itemType,
                weight: weight,
                karat: karat,
                salePrice: parseFloat(salePrice),
                profit: parseFloat(salePrice),
                isRemate: false,
                saleDate: new Date().toISOString().split('T')[0]
            };
            
            soldItems.push(newSale);
            localStorage.setItem('soldItems', JSON.stringify(soldItems));
            
            // Add to cash in
            addToCashIn('Sold - ' + itemName, salePrice);
            
            // Clear form
            document.getElementById('sold-item-code').value = 'S-';
            document.getElementById('sold-item-name').value = '';
            document.getElementById('sold-weight').value = '';
            document.getElementById('sold-karat').value = '';
            document.getElementById('sale-price').value = '';
            
            alert('Sale recorded successfully!');
            loadDashboard();
        }

        // ==================== DASHBOARD FUNCTIONS ====================
        function loadDashboard() {
            const today = new Date().toISOString().split('T')[0];
            
            const activePawns = pawnItems.filter(item => item.status === 'Active').length;
            const expiredPawns = pawnItems.filter(item => item.status === 'Expired').length;
            
            // Today's lukat amount
            const todayLukat = lukatTransactions
                .filter(item => item.lukatDate === today)
                .reduce((sum, item) => sum + item.totalAmount, 0);
            
            // Today's remate amount
            const todayRemate = remateTransactions
                .filter(item => item.remateDate === today && item.remateType !== 'inventory')
                .reduce((sum, item) => sum + item.salePrice, 0);
            
            document.getElementById('active-pawns').textContent = activePawns;
            document.getElementById('expired-pawns').textContent = expiredPawns;
            document.getElementById('today-lukat').textContent = '‚Ç±' + todayLukat.toFixed(2);
            document.getElementById('today-remate').textContent = '‚Ç±' + todayRemate.toFixed(2);
        }

        function showSection(sectionName) {
            // Scroll to section
            const sections = {
                'cash-flow': 'cash-flow-section',
                'prenda': 'prenda-section',
                'lukat': 'lukat-section',
                'remate': 'remate-section',
                'sold': 'sold-section'
            };
            
            const sectionId = sections[sectionName];
            if (sectionId) {
                document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
            }
        }

        // ==================== REPORT FUNCTIONS ====================
        function generateDailyReport() {
            const activePawns = pawnItems.filter(item => item.status === 'Active');
            const expiredPawns = pawnItems.filter(item => item.status === 'Expired');
            const today = new Date().toISOString().split('T')[0];
            
            let totalSales = soldItems
                .filter(item => item.saleDate === today && !item.isRemate)
                .reduce((sum, item) => sum + item.salePrice, 0);
            
            let totalRenewals = renewTransactions
                .filter(item => item.renewDate === today)
                .reduce((sum, item) => sum + item.renewAmount, 0);
            
            let totalLukat = lukatTransactions
                .filter(item => item.lukatDate === today)
                .reduce((sum, item) => sum + item.totalAmount, 0);
            
            let totalRemate = remateTransactions
                .filter(item => item.remateDate === today && item.remateType !== 'inventory')
                .reduce((sum, item) => sum + item.salePrice, 0);
            
            let totalCashIn = 0;
            document.querySelectorAll('.cash-in-amount').forEach(input => {
                totalCashIn += parseFloat(input.value) || 0;
            });
            
            let totalCashOut = 0;
            document.querySelectorAll('.cash-out-amount').forEach(input => {
                totalCashOut += parseFloat(input.value) || 0;
            });
            
            const openingBalance = parseFloat(document.getElementById('opening-balance').value) || 0;
            const closingBalance = openingBalance + totalCashIn - totalCashOut;
            
            const reportHTML = `
                <h3 style="color: #2c3e50; margin-bottom: 20px;">üìä Daily Report - ${today}</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                        <h4 style="margin-bottom: 10px;">üí∞ Cash Summary</h4>
                        <p>Opening Balance: <strong>‚Ç±${openingBalance.toFixed(2)}</strong></p>
                        <p>Total Cash In: <strong class="positive">‚Ç±${totalCashIn.toFixed(2)}</strong></p>
                        <p>Total Cash Out: <strong class="negative">‚Ç±${totalCashOut.toFixed(2)}</strong></p>
                        <p>Closing Balance: <strong>‚Ç±${closingBalance.toFixed(2)}</strong></p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                        <h4 style="margin-bottom: 10px;">üìà Pawn Operations</h4>
                        <p>Active Pawns: <strong>${activePawns.length}</strong></p>
                        <p>Expired Items: <strong class="negative">${expiredPawns.length}</strong></p>
                        <p>Total Lukat: <strong class="positive">‚Ç±${totalLukat.toFixed(2)}</strong></p>
                        <p>Total Remate: <strong class="negative">‚Ç±${totalRemate.toFixed(2)}</strong></p>
                    </div>
                </div>
                
                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                    <h4 style="margin-bottom: 10px;">üìã Today's Transactions</h4>
                    <p>‚Ä¢ New Pawns: ${pawnItems.filter(item => item.pawnDate === today).length}</p>
                    <p>‚Ä¢ Renewals: ${renewTransactions.filter(item => item.renewDate === today).length} (‚Ç±${totalRenewals.toFixed(2)})</p>
                    <p>‚Ä¢ Lukat: ${lukatTransactions.filter(item => item.lukatDate === today).length} (‚Ç±${totalLukat.toFixed(2)})</p>
                    <p>‚Ä¢ Remate: ${remateTransactions.filter(item => item.remateDate === today).length} (‚Ç±${totalRemate.toFixed(2)})</p>
                    <p>‚Ä¢ Direct Sales: ${soldItems.filter(item => item.saleDate === today && !item.isRemate).length} (‚Ç±${totalSales.toFixed(2)})</p>
                </div>
            `;
            
            document.getElementById('report-results').innerHTML = reportHTML;
        }

        function generateRemateReport() {
            const today = new Date().toISOString().split('T')[0];
            const remateItems = pawnItems.filter(item => item.isRemate);
            const foreclosedItems = pawnItems.filter(item => item.status === 'Foreclosed');
            
            const reportHTML = `
                <h3 style="color: #2c3e50; margin-bottom: 20px;">‚öñÔ∏è Remate/Foreclosure Report - ${today}</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                        <h4 style="margin-bottom: 10px;">üìä Remate Statistics</h4>
                        <p>Total Remate Items: <strong>${remateItems.length}</strong></p>
                        <p>Currently Foreclosed: <strong class="negative">${foreclosedItems.length}</strong></p>
                        <p>Remate Sales (Today): <strong>${remateTransactions.filter(item => item.remateDate === today && item.remateType !== 'inventory').length}</strong></p>
                        <p>Auctioned Items: <strong>${pawnItems.filter(item => item.status === 'Auctioned').length}</strong></p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                        <h4 style="margin-bottom: 10px;">üíµ Remate Financials</h4>
                        <p>Total Remate Value: <strong>‚Ç±${remateItems.reduce((sum, item) => sum + item.pawnAmount, 0).toFixed(2)}</strong></p>
                        <p>Remate Sales Revenue: <strong class="positive">‚Ç±${remateTransactions.reduce((sum, item) => sum + (item.salePrice || 0), 0).toFixed(2)}</strong></p>
                        <p>Remate Profit: <strong class="positive">‚Ç±${remateTransactions.reduce((sum, item) => sum + (item.profit || 0), 0).toFixed(2)}</strong></p>
                        <p>Inventory Value: <strong>‚Ç±${foreclosedItems.reduce((sum, item) => sum + item.pawnAmount, 0).toFixed(2)}</strong></p>
                    </div>
                </div>
                
                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                    <h4 style="margin-bottom: 10px;">üìã Expired Items (Need Action)</h4>
                    <table style="width: 100%;">
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Item</th>
                                <th>Amount</th>
                                <th>Expired</th>
                                <th>Days Overdue</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${pawnItems.filter(item => item.status === 'Expired').slice(0, 10).map(item => {
                                const expiryDate = new Date(item.expiryDate);
                                const today = new Date();
                                const daysOverdue = Math.ceil((today - expiryDate) / (1000 * 60 * 60 * 24));
                                return `
                                    <tr>
                                        <td>${item.itemCode}</td>
                                        <td>${item.itemName}</td>
                                        <td>‚Ç±${item.pawnAmount.toFixed(2)}</td>
                                        <td>${item.expiryDate}</td>
                                        <td><span class="negative">${daysOverdue} days</span></td>
                                    </tr>
                                `;
                            }).join('') || '<tr><td colspan="5" style="text-align: center;">No expired items</td></tr>'}
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('report-results').innerHTML = reportHTML;
        }

        function printReport() {
            window.print();
        }

        function clearTodayData() {
            if (confirm('Are you sure you want to clear all cash transactions for today? This will reset cash flow entries but keep item records.')) {
                // Clear cash transactions
                document.getElementById('cash-in-container').innerHTML = '';
                document.getElementById('cash-out-container').innerHTML = '';
                
                // Reset cash arrays
                cashInTransactions = [];
                cashOutTransactions = [];
                localStorage.setItem('cashInTransactions', JSON.stringify(cashInTransactions));
                localStorage.setItem('cashOutTransactions', JSON.stringify(cashOutTransactions));
                
                // Add default rows back
                addCashInRow();
                addCashInRow();
                addCashOutRow();
                addCashOutRow();
                
                calculateTotals();
                alert('Today\'s cash data cleared!');
            }
        }

        // ==================== UTILITY FUNCTIONS ====================
        function setupEventListeners() {
            // Auto-calculate lukat total
            document.getElementById('lukat-interest-rate').addEventListener('change', function() {
                const itemCode = document.getElementById('lukat-item-code').value;
                const item = pawnItems.find(p => p.itemCode === itemCode);
                if (item) {
                    const interestRate = parseFloat(this.value);
                    const interestAmount = item.pawnAmount * (interestRate / 100);
                    const totalAmount = item.pawnAmount + interestAmount;
                    document.getElementById('lukat-total-amount').value = totalAmount.toFixed(2);
                }
            });
            
            // Auto-update totals when opening balance changes
            document.getElementById('opening-balance').addEventListener('input', calculateTotals);
            
            // Auto-save cash transactions
            document.getElementById('cash-in-container').addEventListener('input', saveCashTransactions);
            document.getElementById('cash-out-container').addEventListener('input', saveCashTransactions);
        }

        function saveCashTransactions() {
            // Save cash in transactions
            const cashInRows = document.querySelectorAll('#cash-in-container .transaction-row');
            cashInTransactions = [];
            cashInRows.forEach(row => {
                const desc = row.querySelector('.cash-in-desc').value;
                const amount = parseFloat(row.querySelector('.cash-in-amount').value) || 0;
                if (desc && amount > 0) {
                    cashInTransactions.push({ description: desc, amount: amount });
                }
            });
            localStorage.setItem('cashInTransactions', JSON.stringify(cashInTransactions));
            
            // Save cash out transactions
            const cashOutRows = document.querySelectorAll('#cash-out-container .transaction-row');
            cashOutTransactions = [];
            cashOutRows.forEach(row => {
                const desc = row.querySelector('.cash-out-desc').value;
                const amount = parseFloat(row.querySelector('.cash-out-amount').value) || 0;
                if (desc && amount > 0) {
                    cashOutTransactions.push({ description: desc, amount: amount });
                }
            });
            localStorage.setItem('cashOutTransactions', JSON.stringify(cashOutTransactions));
        }
    </script>
</body>
</html>
